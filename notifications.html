<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifikasi | Putramas Social</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<style>
/* Style Badge Notifikasi */
.menu-item { position: relative; } /* Wajib agar badge menempel */

.nav-badge {
    background-color: #e74c3c; /* Warna Merah */
    color: white;
    font-size: 10px;
    font-weight: bold;
    min-width: 18px; /* Lebar minimum agar bulat */
    height: 18px;
    border-radius: 50%; /* Membuat lingkaran */
    display: none; /* Sembunyi jika 0 */
    align-items: center;
    justify-content: center;
    position: absolute;
    border: 2px solid #fff; /* Border putih biar rapi */
    z-index: 10;
}

/* Posisi di Mobile (Bawah) */
.mobile-nav .nav-badge {
    top: 0px;
    right: 25%; /* Geser supaya pas di pojok ikon */
}

/* Posisi di Sidebar Desktop (Kiri) */
.sidebar-left .nav-badge {
    top: 8px;
    right: 10px; /* Di ujung kanan tombol */
}
</style>
</head>
<body>

    <div class="layout-wrapper">
        <div class="sidebar-left">
            <div class="menu-card">
                <a href="home.html" class="menu-item"><i class="fa-solid fa-house"></i> Beranda</a>
                <a href="notifications.html" class="menu-item">
    <i class="fa-solid fa-bell"></i> Notifikasi
    <span class="nav-badge" id="badgeSidebar">0</span> 
                </a>
                <a href="profile.html" class="menu-item"><i class="fa-solid fa-user"></i> Profil</a>
                <hr style="border: 0; border-top: 1px solid #eee; margin: 5px 0; width: 100%;">
                <a href="#" onclick="disconnect()" class="menu-item" style="color: #e74c3c;"><i class="fa-solid fa-right-from-bracket"></i> Keluar</a>
            </div>
        </div>

        <div class="main-feed">
            <h3 style="margin: 0 0 20px 0; color: #7385a5;">Aktivitas Terbaru</h3>
            <div id="notifContainer">
                <div class="card" style="padding: 20px; text-align: center; color: #999;">Memuat...</div>
            </div>
        </div>
    </div>

    <div class="mobile-nav">
        <a href="home.html" class="menu-item"><i class="fa-solid fa-house" style="font-size: 18px;"></i></a>
        <a href="notifications.html" class="menu-item" style="flex-direction: column; gap: 2px; font-size: 10px;">
    <i class="fa-solid fa-bell" style="font-size: 18px;"></i>
    <span class="nav-badge" id="badgeMobile">0</span> 
        </a>
        <a href="profile.html" class="menu-item"><i class="fa-solid fa-user" style="font-size: 18px;"></i></a>
    </div>

    <script src="main.js"></script>
    <script>
        window.onload = async () => {
            await initApp();
            if(userAddress) loadNotifs();
        };

        async function loadNotifs() {
            try {
                const notifs = await contract.getMyNotifications();
                const container = document.getElementById("notifContainer");
                container.innerHTML = "";

                if(notifs.length === 0) {
                    container.innerHTML = `<div class="card" style="padding: 20px; text-align: center;">Belum ada notifikasi.</div>`;
                    return;
                }

                [...notifs].reverse().forEach(n => {
                    // Tentukan Icon & Pesan berdasarkan Action Type
                    let icon = '<i class="fa-solid fa-circle-info"></i>';
                    let text = 'berinteraksi dengan post Anda';
                    let color = '#7385a5';

                    if(n.actionType === "LIKE") {
                        icon = '<i class="fa-solid fa-heart"></i>';
                        text = 'menyukai postingan Anda';
                        color = '#e74c3c';
                    } else if (n.actionType === "COMMENT") {
                        icon = '<i class="fa-solid fa-comment"></i>';
                        text = 'mengomentari postingan Anda';
                        color = '#3498db';
                    } else if (n.actionType === "RATE") {
                        icon = '<i class="fa-solid fa-star"></i>';
                        text = 'memberi bintang pada postingan Anda';
                        color = 'gold';
                    }

                    const html = `
                    <div class="card" style="padding: 15px; display: flex; gap: 15px; align-items: center;">
                        <div style="font-size: 24px; color: ${color}; width: 30px; text-align: center;">
                            ${icon}
                        </div>
                        <div>
                            <div style="font-size: 14px;">
                                <strong>${n.actor.substring(0,6)}...</strong> ${text}
                            </div>
                            <div style="font-size: 11px; color: #999; margin-top: 4px;">
                                ${new Date(n.timestamp * 1000).toLocaleString()}
                            </div>
                        </div>
                    </div>`;
                    container.innerHTML += html;
                });
            } catch (e) {
                console.error(e);
            }
        }
    </script>
</body>
</html>
