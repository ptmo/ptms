<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Arsip Wayang</title>
    <meta name="description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official">
    <meta name="keywords" content="
Wayang,
Wayang Kulit,
Wayang Kulit Indonesia,
Wayang Indonesia,
Wayang Nusantara,

Wayang Kulit Gagrak Cirebon,
Wayang Gagrak Cirebon,
Wayang Cirebon,
Wayang Kulit Cirebon,

Wayang Kulit Jawa,
Wayang Kulit Jawa Tengah,
Wayang Kulit Jawa Timur,
Wayang Kulit Jawa Barat,

Wayang Kulit Gagrak Yogyakarta,
Wayang Kulit Gagrak Surakarta,
Wayang Kulit Gagrak Solo,
Wayang Kulit Gagrak Banyumas,
Wayang Kulit Gagrak Kedu,
Wayang Kulit Gagrak Mataram,

Wayang Kulit Purwa,
Wayang Kulit Parwa,
Wayang Kulit Bali,
Wayang Bali,

Wayang Kulit Sasak,
Wayang Sasak Lombok,

Wayang Kulit Madura,
Wayang Madura,

Wayang Kulit Banjar,
Wayang Banjar Kalimantan,

Wayang Kulit Betawi,
Wayang Betawi,

Wayang Kulit Sunda,
Wayang Golek,
Wayang Golek Sunda,
        
Wayang Kulit Pesisiran,
Wayang Kulit Pantura,
        
Wayang Ramayana,
Wayang Mahabharata,
Tokoh Wayang,
Arsip Wayang,
Galeri Wayang,
Koleksi Wayang Kulit
">
    <meta name="robots" content="index, follow">

    <link rel="canonical" href="https://putramas.web.id">

    <meta property="og:title" content="Putramas Official | Digital Galeri Wayang Nusantara>
    <meta property="og:description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official.">
    <meta property="og:url" content="https://putramas.web.id">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://putramas.web.id/img/og.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Putramas Official | Digital Galeri Wayang Nusantara">
    <meta name="twitter:description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official.">
    <meta name="twitter:image" content="https://putramas.web.id/img/og.png">
    
    <link rel="icon" href="/img/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/img/icon-512.png">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #8b5a2b;
            --dark: #1a1510;
            --light: #e0d8c3;
            --accent: #deb887;
        }

        * { box-sizing: border-box; }
        body { 
            font-family: 'Rubik', sans-serif; 
            background-color: #f6f9ff; 
            color: #5c6a84; 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            background: #fff;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .nav-left { display: flex; align-items: center; gap: 15px; }
        
        .nav-logo {
            width: 45px; height: 45px;
            border-radius: 50%;
            border: 2px solid #7385a5;
            object-fit: cover;
        }
        
        #btn-connect {
            background: transparent; color: #7385a5; border: 2px solid #7385a5; 
            padding: 10px 25px; cursor: pointer; font-family: 'Rubik', sans-serif; 
            font-weight: bold; border-radius: 30px; transition: 0.3s; font-size: 14px;
        }
        #btn-connect:hover { background: #f6f9ff; color: #7385a5; border: 2px solid #7385a5; }
        #btn-connect.connected { background: #7385a5; color: #fff; border-color: #abb6c9; cursor: default; }

        @media (max-width: 600px) {
            .navbar { padding: 15px 20px; }
            .nav-brand { font-size: 0.9em; }
            #btn-connect { padding: 8px 15px; font-size: 12px; }
            h1 { font-size: 2em; }
        }
        
        .container { max-width: 1100px; margin: 40px auto; display: flex; flex-wrap: wrap; gap: 40px; padding: 20px; }
        
        .left-col { flex: 1; min-width: 300px; }
        .img-frame { 
            background: #fdfbf7; border: 10px solid #e6e6e6; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); border-radius: 5px; 
            overflow: hidden; position: relative; 
        }
        .img-frame img { width: 100%; height: auto; display: block; }
        .id-badge { 
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); 
            color: white; padding: 5px 10px; font-size: 12px; border-radius: 4px; 
        }

        .right-col { flex: 1.5; min-width: 300px; }
        h1, h2, h3  { margin: 0 0 10px 0; color: #7385a5; border-bottom: 2px solid #b3b3b3; display: inline-block; padding-bottom: 10px; }
        .gaya-tag { background: #7385a5; color: white; padding: 4px 12px; border-radius: 20px; border: 2px solid #5c6a84; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; vertical-align: middle; margin-left: 15px; }

        /* BARU V3.2 */
        .description { 
    background: #e9f0ff; 
    border: 1px solid #7385a5; 
    border-radius: 20px; 
    font-size: 13px; 
    color: #666666; 
    margin-bottom: 30px; 
    text-align: justify;
    font-family: "Nunito", sans-serif;
    font-weight: 600;
    font-style: normal;
    padding: 20px;       /* Memberi jarak napas teks dari pinggir kotak */
    width: 100%;         /* Pastikan memenuhi kolom kanan */
    height: auto;        /* Tinggi otomatis mengikuti panjang teks */
    box-sizing: border-box; /* Agar padding tidak membuat kotak melebar keluar */
        }
        
        /* --- 1. STYLE GLOBAL (HP & PC) --- */
.meta-grid { 
    display: grid;
    /* PENTING: minmax(140px, 1fr) artinya lebar kotak minimal 140px. 
       Di HP standar (360px) ini akan otomatis jadi 2 KOLOM yang pas. 
       Tidak akan maksa 3 kolom lagi. */
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px; 
    margin-bottom: 30px; 
}

.meta-box { 
    background: #e9f0ff; 
    padding: 12px 15px; /* Padding sedang */
    border-radius: 15px; 
    border: 1px solid #7385a5; /* Border ditipiskan dikit biar rapi */
    
    /* Flexbox biar isi vertikal rapi */
    display: flex;
    flex-direction: column;
    justify-content: center; 
}

.meta-label { 
    font-size: 11px; /* Ukuran pas untuk label (Standar Industri) */
    text-transform: uppercase; 
    color: #7385a5; 
    letter-spacing: 0.5px; 
    font-weight: 600;
    margin-bottom: 5px; 
    line-height: 1.2;
}

.meta-value { 
    font-size: 14px; /* Ukuran isi data */
    font-weight: bold; 
    color: #5c6a84;
    word-wrap: break-word; /* Mencegah teks panjang merusak kotak */
}

/* --- 2. KHUSUS PC / TABLET (Layar Lebar) --- */
@media screen and (min-width: 992px) {
    .meta-grid {
        /* Di PC, kita paksa kotak lebih lebar lagi (Min 200px). 
           Ini akan membuat tampilan jadi 3 atau 4 kolom yang LEGA. */
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important; 
        gap: 20px;
    }
    
    .meta-value {
        font-size: 15px; /* Di PC dibesarkan sedikit isinya */
    }
}

        .silsilah-box { background: #e9f0ff; padding: 20px; border: 1px solid #7385a5; border-radius: 20px; }
        .silsilah-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #666; padding: 10px 0; }
        
        .social-section { margin-top: 40px; border-top: 1px dashed #5d4037; padding-top: 20px; }
        .review-box { background: #e9f0ff; padding: 20px; border-radius: 20px; border: 1px solid #7385a5; margin-bottom: 20px; }
        
        .star-rating span { font-size: 30px; cursor: pointer; color: #444; transition: 0.2s; }
        .star-rating span:hover, .star-rating span.active { color: gold; }
        
        .chip { background: #e9f0ff; color: #666; border: 1px solid #7385a5; padding: 8px 15px; border-radius: 20px; cursor: pointer; transition: 0.2s; margin-bottom: 5px; font-weight: bold; }
        .chip:hover, .chip.selected { background: #7385a5; color: #fff; font-weight: bold; }
        .review-card {
    background: #e9f0ff;
    padding: 15px;
    border: 1px solid #7385a5;
    margin-bottom: 15px;
    
    /* BENTUK CHAT BUBBLE (Sesuai Ikon Referensi) */
    /* Urutan: Kiri-Atas | Kanan-Atas | Kanan-Bawah | Kiri-Bawah */
    border-radius: 25px 25px 25px 0px !important;
    
    /* Opsional: Tambahkan sedikit shadow biar lebih pop-up */
    box-shadow: 2px 2px 5px rgba(115, 133, 165, 0.2);
        }
        
        .footer {
            background: #fff;
            padding: 20px 20px;
            margin-top: 25px;
            text-align: center;
            width: 100%; /* WAJIB FULL */
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .social-icons { margin-bottom: 10px; }
        
        .social-link {
            display: inline-flex; justify-content: center; align-items: center;
            width: 35px; height: 35px; margin: 0 07px;
            border-radius: 50%; background: #7385a5; color: #fff;
            font-size: 15px; transition: all 0.3s ease; border: 1.5px solid #7385a5;
            text-decoration: none;
        }
        .social-link:hover {
            background: #fff; color: #7385a5;
            transform: translateY(-5px); box-shadow: 0 0 15px #7385a5;
        }

        .copyright { color: #888; font-size: 13px; letter-spacing: 1px; margin-top: 10px; }

    #toast {
    visibility: hidden;
    min-width: 220px;
    max-width: 85%;
    position: fixed;
    z-index: 99999;
    top: 90px;
    right: 20px;
    left: auto;
    background-color: rgba(51, 51, 51, 0.95);
    backdrop-filter: blur(8px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.15);
    color: #fff;
    padding: 10px 35px 10px 15px; 
    display: flex;
    align-items: center;
    font-family: 'Rubik', sans-serif;
    font-weight: 500;
    font-size: 11px;
    letter-spacing: 0.3px;
    opacity: 0;
    transform: translateX(20px) scale(0.9); 
    transition: all 0.4s cubic-bezier(0.2, 0, 0, 1), visibility 0s 0.4s; 
}

#toast.show {
    visibility: visible;
    opacity: 1;
    transform: translateX(0) scale(1);
    transition: all 0.4s cubic-bezier(0.2, 0, 0, 1), visibility 0s 0s;
}
    
#toast .toast-icon {
    width: 23px;
    height: 23px; 
    margin-right: 10px; 
    object-fit: contain;
}

#toast .toast-close {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 9px;
    height: 9px;
    cursor: pointer;
    opacity: 0.6;
    transition: 0.2s;
}

        #toast .toast-close:hover { opacity: 1; transform: scale(1.1); }

    #toast.info {
    background: rgba(0, 53, 107, 0.35);
    border: 1px solid rgba(0, 100, 204, 0.4);
    color: #fff;
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.35), 0 0 20px rgba(0, 100, 255, 0.25);
}

#toast.success {
    background: rgba(0, 77, 7, 0.35);
    color: #fff;
    border: 1px solid rgba(0, 184, 15, 0.4);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.35), 0 0 20px rgba(0,255,0,0.2);
}

#toast.error {
    background: rgba(107, 0, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(184, 0, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.40), 0 0 22px rgba(255,0,0,0.25);
    }

#toast.warning {
    background: rgba(102, 98, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(179, 171, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.40), 0 0 20px rgba(255,255,0,0.25);
}

#toast.wolf {
    background: rgba(125, 65, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(204, 106, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(255,140,0,0.25);
}

#toast.load {
    background: rgba(49, 77, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(104, 163, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(0,255,0,0.25);
}
    
#toast.loading {
    background: rgba(52, 90, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(94, 163, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(94, 163, 0, 0.25);
}

@keyframes slideDown {
    from {top: -50px; opacity: 0;}
    to {top: 30px; opacity: 1;}
}

@keyframes fadeOut {
    from {top: 30px; opacity: 1;}
    to {top: -50px; opacity: 0;}
        }

        /* --- MODAL PREMIUM STYLE --- */

/* Latar Belakang Gelap (Overlay) */
.zoom-modal {
    display: none; 
    position: fixed; 
    z-index: 99999; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    background-color: rgba(0, 0, 0, 0.95); /* Lebih gelap biar fokus */
    backdrop-filter: blur(8px); /* Efek blur mahal */
    
    /* Flexbox untuk Centering Sempurna */
    align-items: center; 
    justify-content: center;
    overflow: hidden; /* Mencegah scroll di dalam modal */
}

/* Gambar Zoom */
.zoom-modal-content {
    max-width: 90%; 
    max-height: 90vh; /* Maksimal 90% tinggi layar */
    object-fit: contain; /* Gambar tidak akan gepeng */
    border-radius: 8px;
    box-shadow: 0 0 50px rgba(0,0,0,0.5); /* Shadow halus */
    transform: scale(0.9);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Animasi membal */
}

/* Class untuk Animasi Masuk */
.zoom-modal.active .zoom-modal-content {
    transform: scale(1);
    opacity: 1;
}

/* Tombol Close Premium */
.zoom-close {
    position: absolute;
    top: 10px;
    right: 25px;
    color: #e74c3c;
    background: rgba(255, 255, 255, 0.1);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255,255,255,0.2);
}

.zoom-close:hover {
    background: #e74c3c;
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    transform: rotate(90deg); /* Efek putar saat hover */
}

/* Cegah Scroll Body saat Modal Aktif */
body.modal-open {
    overflow: hidden;
}

        /* Style Dasar Tombol Premium */
.btn-premium {
    background: #7385a5; 
    color: white; 
    border: 2px solid #a6b4cd; 
    padding: 12px 25px; 
    border-radius: 50px; 
    cursor: pointer; 
    width: 60%; 
    font-weight: bold; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    gap: 8px; 
    margin: 0 auto; 
    
    /* Efek Awal */
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); /* Transisi Super Smooth */
}

/* Efek Saat Hover (Disentuh Mouse) */
.btn-premium:hover {
    background: #5c6a84; /* Warna sedikit menua */
    border: 2px solid #7385a5;
    transform: translateY(-3px) scale(1.02); /* Tombol naik sedikit & membesar halus */
    box-shadow: 0 10px 20px rgba(115, 133, 165, 0.4); /* Bayangan melebar lembut (Glow effect) */
}

/* Efek Saat Klik (Ditekan) */
.btn-premium:active {
    transform: translateY(-1px) scale(0.98); /* Efek membal saat ditekan */
    box-shadow: 0 5px 10px rgba(115, 133, 165, 0.3);
}

        /* Style Tombol Aksi Premium */
/* 1. CONTAINER GRID: Membagi 4 Kolom Sama Besar */
.premium-action-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 Kolom Rata */
    gap: 12px; /* Jarak antar tombol yang rapi */
    width: 100%;
    padding: 0 5px; /* Sedikit padding agar tidak mepet layar HP */
}

/* 2. TOMBOL PREMIUM: Style Baru */
.btn-action-premium {
    background: #f6f9ff; /* Latar putih bersih */
    border: 2px solid #7385a5; /* Border abu sangat tipis */
    color: #7385a5;
    
    /* Ukuran & Bentuk */
    width: 100%; /* Memenuhi kotak grid */
    height: 45px; /* Tinggi fix agar seragam */
    border-radius: 12px; /* 'Squircle' modern (bukan bulat penuh) terlihat lebih mahal */
    
    /* Layout Isi */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    
    /* Typography */
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    
    /* Efek 3D Halus (Shadow) */
    box-shadow: 0 4px 6px rgba(115, 133, 165, 0.05), 0 1px 3px rgba(0,0,0,0.05);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

/* 3. EFEK HOVER: Saat disentuh */
.btn-action-premium:hover {
    background: #7385a5;
    border: 2px solid #a6b4cd;
    color: #ffffff;
    transform: translateY(-3px); /* Tombol naik */
    box-shadow: 0 8px 15px rgba(115, 133, 165, 0.25); /* Bayangan soft */
}

/* 4. EFEK KLIK: Saat ditekan */
.btn-action-premium:active {
    transform: scale(0.95); /* Efek membal */
    box-shadow: 0 2px 4px rgba(115, 133, 165, 0.1);
}

/* 5. Khusus Icon agar animasi warna halus */
.btn-action-premium i {
    transition: transform 0.3s;
}
.btn-action-premium:hover i {
    transform: scale(1.1); /* Icon membesar dikit saat hover */
}
        /* 1. Overlay Transparan (Hanya untuk deteksi klik luar) */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: transparent; /* Tidak ada warna/blur */
    backdrop-filter: none;
    z-index: 9998;
    display: none;
    /* Ubah dari flex ke block agar kita bisa atur posisi absolute manual */
    display: none; 
}

.modal-overlay.active {
    display: block; 
}

/* 2. Kartu Modal (Menjadi Dropdown) */
.modal-card {
    position: absolute; /* Kunci posisi */
    
    /* ATUR POSISI DISINI SESUAI TINGGI NAVBAR ANDA */
    top: 70px;  /* Jarak dari atas (sesuaikan dengan tinggi navbar) */
    right: 20px; /* Jarak dari kanan (supaya lurus dengan tombol connect) */
    
    width: 300px; /* Lebar fix agar rapi */
    background: #fff;
    padding: 20px;
    border-radius: 12px; /* Radius lebih kecil ala dropdown */
    
    /* Shadow Premium Soft */
    box-shadow: 0 5px 30px rgba(0,0,0,0.15); 
    border: 1px solid rgba(0,0,0,0.05); /* Border tipis halus */
    
    text-align: center;
    font-family: 'Rubik', sans-serif;
    
    /* Animasi Muncul dari atas */
    opacity: 0;
    transform: translateY(-10px) scale(0.95);
    transform-origin: top right; /* Animasi mulai dari pojok kanan atas */
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
}

/* State Aktif */
.modal-overlay.active .modal-card {
    opacity: 1;
    transform: translateY(0) scale(1);
}

/* (Opsional) Segitiga Kecil Penunjuk ke Atas (Arrow) */
.modal-card::before {
    content: "";
    position: absolute;
    top: -6px; /* Muncul di atas kotak */
    right: 20px; /* Posisi sejajar tombol */
    width: 12px;
    height: 12px;
    background: #fff;
    transform: rotate(45deg); /* Putar jadi wajik */
    border-left: 1px solid rgba(0,0,0,0.05);
    border-top: 1px solid rgba(0,0,0,0.05);
    box-shadow: -2px -2px 5px rgba(0,0,0,0.02);
}
    
/* Header */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}
.modal-header h3 { margin: 0; font-size: 18px; color: #333; }
.close-btn { background: none; border: none; font-size: 18px; cursor: pointer; color: #888; }

/* Status Badge & Dot Kelap Kelip */
.modal-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
    padding: 10px 15px;
    border-radius: 10px;
    margin-bottom: 15px;
}
.status-badge {
    color: #27ae60;
    font-weight: bold;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.status-label { color: #888; }
    
.pulse-dot {
    width: 8px; height: 8px;
    background-color: #27ae60;
    border-radius: 50%;
    box-shadow: 0 0 0 rgba(39, 174, 96, 0.4);
    animation: pulse 1.5s infinite;
}
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
    70% { box-shadow: 0 0 0 6px rgba(39, 174, 96, 0); }
    100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
}

/* Saldo */
.modal-balance { margin-bottom: 20px; }
.balance-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
.balance-amount { font-size: 24px; font-weight: bold; color: #2c3e50; margin-top: 5px; }

/* Address Box (Copyable) */
.modal-address-box {
    background: #f1f2f6;
    padding: 12px;
    border-radius: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all 0.2s;
    margin-bottom: 25px;
}
.modal-address-box:hover { border-color: #3498db; background: #eaf6ff; }
.address-text { font-family: monospace; font-size: 14px; color: #555; }
.copy-icon { color: #3498db; }

/* Tombol Aksi */
.modal-actions { display: flex; flex-direction: column; gap: 10px; }
.action-btn {
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    transition: transform 0.1s;
}
.action-btn:active { transform: scale(0.98); }
.action-btn.primary { background: #7385a5; color: white; }
.action-btn.danger { background: #fee; color: #e74c3c; border: 1px solid #fcc; }

        /* Overlay Gelap */
.sawer-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
    z-index: 9999; display: none; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.3s;
}
.sawer-overlay.active { opacity: 1; }

/* Kartu Modal */
.sawer-card {
    background: #f6f9ff; width: 90%; max-width: 400px;
    border-radius: 20px; padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transform: translateY(20px); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    font-family: 'Rubik', sans-serif;
    border: 2px solid #7385a5;
}
.sawer-overlay.active .sawer-card { transform: translateY(0); }

/* Komponen Header */
.sawer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
.sawer-header h3 { margin: 0; color: #7385a5; font-size: 14px; }
.sawer-close {
    position: absolute; /* Kunci: Lepas dari aliran teks, nempel ke pojok */
    top: 15px;          /* Jarak dari sisi Atas */
    right: 15px;        /* Jarak dari sisi Kanan */
    
    background: none;
    border: none;
    font-size: 20px;
    color: #7385a5;
    cursor: pointer;
    z-index: 10;        /* Pastikan selalu di lapisan atas */
    
    /* Opsional: Efek Hover biar enak */
    transition: transform 0.2s;
}

.sawer-close:hover {
    transform: rotate(90deg); /* Efek putar sedikit saat disentuh */
    color: #5c6a84;
}
        
/* Indikator Jaringan */
.network-indicator {
    display: flex; align-items: center; gap: 8px; font-size: 11px;
    color: #27ae60; background: rgba(39, 174, 96, 0.1);
    padding: 6px 12px; border-radius: 20px; width: fit-content; margin-bottom: 20px; font-weight: 600;
}
.pulse-green {
    width: 8px; height: 8px; background: #27ae60; border-radius: 50%;
    box-shadow: 0 0 0 rgba(39, 174, 96, 0.4); animation: pulse 1.5s infinite;
}

/* Info Box */
.sawer-info-box { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #7385a5; }
.info-row { display: flex; justify-content: space-between; font-size: 13px; color: #555; margin-bottom: 4px; }
.info-row.sub { font-size: 11px; color: #999; }
.info-row.highlight { color: #7385a5; font-weight: bold; font-size: 14px; }
.info-row .mono { font-family: monospace; }
.divider { height: 1px; background: #e0e0e0; margin: 8px 0; }

/* Input & Buttons */
.input-group label { display: block; font-size: 12px; color: #7385a5; margin-bottom: 5px; font-weight: 600; }
.input-wrapper { position: relative; display: flex; align-items: center; }
.input-wrapper input {
    width: 100%; padding: 12px; padding-right: 50px;
    border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; font-weight: bold; color: #2c3e50;
    transition: border-color 0.2s;
}
.input-wrapper input:focus { border-color: #7385a5; outline: none; }
.suffix { position: absolute; right: 15px; color: #95a5a6; font-weight: 600; font-size: 12px; }
.limit-info { font-size: 10px; color: #7385a5; margin-top: 4px; display: block; }
textarea { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 10px; font-family: inherit; resize: none; }

.percent-grid { 
    display: grid; 
    grid-template-columns: repeat(5, 1fr); /* UBAH 4 JADI 5 AGAR SEJAJAR */
    gap: 4px; /* Perkecil jarak antar tombol */
    margin-top: 10px; 
}

.percent-grid button {
    background: #fff; 
    border: 1px solid #7385a5; 
    border-radius: 6px; /* Radius sedikit diperkecil */
    padding: 6px 2px; /* Padding kiri-kanan dipersempit */
    font-size: 10px; /* Font dikecilkan sedikit agar muat */
    font-weight: bold; 
    color: #555; 
    cursor: pointer; 
    transition: 0.2s;
    white-space: nowrap; /* Agar teks tidak turun baris */
}

.percent-grid button:hover { 
    background: #e3e7ed; 
    border-color: #7385a5; 
}
        
.btn-sawer-send {
    width: 100%; background: linear-gradient(135deg, #abb6c9 0%, #7385a5 100%);
    color: white; border: none; padding: 14px; border-radius: 12px;
    font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px;
    box-shadow:
  0 4px 15px rgba(115, 133, 165, 0.25),
  0 0 0 1px rgba(115, 133, 165, 0.15);
    display: flex; align-items: center; justify-content: center; gap: 8px;
}
        
.btn-sawer-send:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(115, 133, 165, 0.4);
}

.btn-sawer-send:disabled {
  background: #687895;
  border: 2px solid #9daac0;
  cursor: not-allowed;
}
        
@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Hapus paksa segala jenis garis di Judul Modal */
.sawer-header h3 {
    text-decoration: none !important; /* Hapus Underline */
    border-bottom: none !important;   /* Hapus Border */
    padding-bottom: 0 !important;     /* Hapus Jarak sisa */
    display: inline-block;            /* Pastikan blok rapi */
}

/* Pastikan wadahnya juga bersih */
.sawer-header {
    border-bottom: none !important;
}

        /* Overlay Gelap */
.dl-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.65); backdrop-filter: blur(4px);
    z-index: 10000; display: none; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.3s;
}
.dl-overlay.active { opacity: 1; }

/* Kartu Popup */
.dl-card {
    background: white; width: 90%; max-width: 380px;
    border-radius: 20px; padding: 30px 25px;
    text-align: center; font-family: 'Rubik', sans-serif;
    transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 15px 40px rgba(0,0,0,0.25);
}
.dl-overlay.active .dl-card { transform: scale(1); }

/* Icon Besar */
.dl-icon-box {
    width: 70px; height: 70px; background: #e6f8ee; color: #06bb55;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 30px; margin: 0 auto 20px;
}

/* Teks & Detail File */
.dl-card h3 { margin: 0 0 10px; color: #7385a5; font-size: 20px; }
.dl-card p { margin: 0 0 20px; color: #7f8c8d; font-size: 14px; }

.file-details {
    background: #f8f9fa; border: 1px solid #e0e0e0;
    padding: 15px; border-radius: 12px; margin-bottom: 25px;
    display: flex; flex-direction: column; gap: 5px;
}
.fname { font-weight: bold; color: #2c3e50; word-break: break-all; font-size: 14px; }
.fsize { font-size: 12px; color: #7385a5; font-weight: 600; }

/* Tombol Aksi */
.dl-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.btn-no {
    background: #f1f2f6; color: #7f8c8d; border: none;
    padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer;
    transition: 0.2s;
}
.btn-no:hover { background: #e0e0e0; color: #333; }

.btn-yes {
    background: #7385a5;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;

    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;

    /* Shadow senada */
    box-shadow: 0 4px 15px rgba(115, 133, 165, 0.35);

    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.btn-yes:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 22px rgba(115, 133, 165, 0.45);
}

.btn-yes:active {
    transform: translateY(0);
    box-shadow: 0 4px 14px rgba(115, 133, 165, 0.3);
}

        /* Styling Area History di Modal */
.modal-history-section {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 15px;
}

.history-scroll-area {
    max-height: 120px; /* Batasi tinggi agar tidak memenuhi layar */
    overflow-y: auto;  /* Aktifkan Scroll Vertikal */
    padding-right: 5px;
}

/* Custom Scrollbar Tipis */
.history-scroll-area::-webkit-scrollbar { width: 4px; }
.history-scroll-area::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }

/* Kartu Item Riwayat Mini */
.mini-history-item {
    background: #fff;
    border: 1px solid #eee;
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 6px;
    font-size: 11px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.mini-sender { font-weight: bold; color: #5c6a84; }
.mini-amount { color: #27ae60; font-weight: bold; }
.mini-msg { 
    display: block; 
    font-size: 10px; 
    color: #888; 
    font-style: italic; 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
    max-width: 150px;
}

      /* Owner Stats Card */
.owner-stat-card {
    background: #e9f0ff;
    border: 1px solid #7385a5;
    border-radius: 16px;
    padding: 15px;
    margin-top: 15px;
    margin-bottom: 25px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.owner-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.owner-profile-link {
    display: flex; align-items: center; gap: 10px; text-decoration: none;
}

.owner-stats-row {
    display: flex;
    background: #f6f9ff;
    border: 1px solid #7385a5;
    border-radius: 10px;
    padding: 10px;
}

.stat-item-col {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
}

.stat-icon-circle {
    width: 25px; height: 25px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px;
}

.stat-text-group {
    display: flex; flex-direction: column;
}

.stat-label-mini { font-size: 9px; color: #999; letter-spacing: 0.5px; text-transform: uppercase; }
.stat-value-bold { font-size: 13px; font-weight: 700; color: #7385a5; }

        #sawerMessage:focus {
            border: 2px solid #7385a5 !important;
            outline: none;
        }

        /* --- STYLE REKOMENDASI (RESPONSIF & ADAPTIF) --- */
/* BARU V3.2 */
/* Container Utama */
.related-section {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px dashed #d1d9e6; /* Pemisah yang jelas */
    width: 100%;
    box-sizing: border-box;
}

.related-title {
    font-size: 14px;
    font-weight: 700;
    color: #7385a5;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* --- TAMPILAN DEFAULT (HP/TABLET): GRID KOTAK --- */
.related-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2 Kolom di HP */
    gap: 10px;
}

.mini-rel-card {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 12px;
    overflow: hidden;
    text-decoration: none;
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    flex-direction: column; /* Gambar di atas, Teks di bawah */
}

.img-container {
    width: 100%;
    height: 140px; /* Tinggi standar HP */
    background: #f8f9fa;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding: 10px;
    position: relative;
    border-bottom: 1px solid #f0f0f0;
}

.mini-rel-img {
    width: auto;
    height: 100%;
    max-width: 90%;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}

.mini-rel-info {
    padding: 10px;
    text-align: center;
}

.mini-rel-name {
    font-size: 11px;
    font-weight: 700;
    color: #5c6a84;
    display: block;
    margin-bottom: 4px;
}

.badge-gaya {
    font-size: 9px;
    background: #e3f2fd;
    color: #1565c0;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: 600;
}

/* --- TAMPILAN KHUSUS PC (LAYAR BESAR) --- */
/* Mengubah Grid menjadi List Vertikal di Kolom Kiri */
@media (min-width: 992px) {
    .related-grid {
        display: flex;       /* Ubah jadi Flex */
        flex-direction: column; /* Susun ke BAWAH (Vertikal) */
        gap: 12px;
    }

    .mini-rel-card {
        flex-direction: row; /* Ubah jadi Horizontal (Gambar Kiri, Teks Kanan) */
        height: 80px;        /* Tinggi fix lebih kecil agar muat banyak */
        align-items: center;
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    }

    .mini-rel-card:hover {
        transform: translateX(5px); /* Efek geser kanan sedikit */
        border-color: #7385a5;
    }

    .img-container {
        width: 70px;  /* Lebar fix untuk gambar kecil */
        height: 100%; /* Full tinggi kartu */
        border-bottom: none;
        border-right: 1px solid #f0f0f0;
        background: #fff;
        padding: 5px;
    }

    .mini-rel-img {
        max-width: 100%;
        max-height: 100%;
    }

    .mini-rel-info {
        flex: 1;
        text-align: left; /* Teks rata kiri */
        padding: 0 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .mini-rel-name {
        font-size: 12px;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 160px; /* Batasi lebar teks */
    }
    
    .meta-row {
        justify-content: flex-start; /* Badge rata kiri */
    }
    }
    </style>
</head>
<body>
<nav class="navbar">
        <div class="nav-left">
  <a href="index" style="display: flex; align-items: center; text-decoration: none;">
    <img src="img/icon-192.png" class="nav-logo" style="margin-right:8px;">
    <span class="nav-brand" style="font-size:20px; color: #7385a5; font-weight:bold;">Putramas Official</span>
  </a>
        </div>
        <div class="nav-right">
        <button id="btn-connect" onclick="connectWallet()">
            <i class="fas fa-wallet"></i> Hubungkan
        </button>
    </div>
</nav>

<div id="loading" style="text-align: center; margin-top: 100px; font-size: 14px; color: #7385a5; font-weight: 500; letter-spacing: 0.5px;">
    <i class="fas fa-circle-notch fa-spin" style="font-size: 22px; vertical-align: middle; margin-right: 10px;"></i> 
    Membuka Detail Arsip...
</div>

<div id="content" class="container" style="display: none;">
    <div class="left-col">
    <div class="img-frame wayang-img-wrapper" style="position: relative; display: inline-block; width: 100%;">
        
        <div class="id-badge" style="position: absolute; top: 10px; right: 10px; z-index: 30; 
             background: rgba(0, 0, 0, 0.6); color: #fff; padding: 5px 10px; 
             border-radius: 5px; font-weight: bold; font-size: 11px; pointer-events: none;">
            NFT ID: #<span id="displayId">0</span>
        </div>

        <img id="displayImg" src="" 
     onclick="openZoom(this)" 
     style="width: 100%; display: block; cursor: zoom-in;">
        </div>

    <div style="text-align: center; margin-top: 20px; color: #666; font-size: 12px;">
        Permanen di Base Mainnet
    </div>
    </div>

    <div id="myZoomModal" class="zoom-modal" onclick="closeZoom()">
    <div class="zoom-close" onclick="closeZoom()">
        <i class="fas fa-times"></i>
    </div>
    
    <img class="zoom-modal-content" id="img01">
    </div>

    <div class="right-col">
        <div>
            <h2 id="displayName">Nama Tokoh</h2>
            <span id="displayGaya" class="gaya-tag">Gaya</span>
        </div>

        <h3 style="color:#7385a5; border-bottom:1px solid #444; padding-bottom:5px;">Deskripsi</h3>
        <p class="description" id="displayDesc">Deskripsi...</p>

        <h3 style="color:#7385a5; border-bottom:1px solid #444; padding-bottom:5px;">Data Fisik & Budaya</h3>
        <div class="meta-grid">
            <div class="meta-box"><span class="meta-label">Golongan:</span><span class="meta-value" id="displayGolongan">-</span></div>
            <div class="meta-box"><span class="meta-label">Wanda:</span><span class="meta-value" id="displayWanda">-</span></div>
            <div class="meta-box"><span class="meta-label">Material Kulit:</span><span class="meta-value" id="displayKulit">-</span></div>
            <div class="meta-box"><span class="meta-label">Material Gapit:</span><span class="meta-value" id="displayGapit">-</span></div>
            <div class="meta-box"><span class="meta-label">Penatah:</span><span class="meta-value" id="displayPenatah">-</span></div>
            <div class="meta-box"><span class="meta-label">Penyungging:</span><span class="meta-value" id="displayPenyungging">-</span></div>
            <div class="meta-box"><span class="meta-label">Tahun Pembuatan:</span><span class="meta-value" id="displayTahun">-</span></div>
            <div class="meta-box"><span class="meta-label">Kolektor:</span><span class="meta-value" id="displayKolektor">-</span></div>
        </div>

        <h3 style="color:#7385a5; border-bottom:1px solid #444; padding-bottom:5px;">Silsilah & Asal Usul</h3>
        <div class="silsilah-box">
            <div class="silsilah-row"><span style="color:#666">Negara:</span><span style="font-weight:bold" id="displayNegara">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Ayah:</span><span style="font-weight:bold" id="displayAyah">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Ibu:</span><span style="font-weight:bold" id="displayIbu">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Pusaka:</span><span style="font-weight:bold" id="displayPusaka">-</span></div>
        </div>

        <div class="social-section">
    <div style="margin-bottom: 25px;">
        
        <div class="premium-action-grid">
            
            <button onclick="kirimLike()" id="btnLike" class="btn-action-premium" title="Suka">
                <i class="fas fa-heart"></i> 
                <span id="likeCount" style="font-size: 15px; margin-left: 2px;">0</span>
            </button>

            <button onclick="panggilSawerDetail()" id="btnSawer" class="btn-action-premium" title="Sawer">
               <i class="fas fa-gift"></i>
               <span id="sawerCount" style="font-size: 15px; margin-left: 5px;">0</span>
            </button>
            
            <button onclick="downloadSertifikatHD()" id="btnDownloadHD" class="btn-action-premium" title="Simpan">
                <i class="fas fa-file-download"></i>
            </button>

            <button onclick="smartShare()" id="btnShare" class="btn-action-premium" title="Bagikan">
                <i class="fas fa-share-alt"></i>
            </button>

        </div>

        <center>
            <div style="margin-top: 15px; color: #7385a5; font-size: 11px; font-weight: 500; letter-spacing: 0.5px; opacity: 0.8;">
                <i class="fas fa-info-circle"></i> Klik ikon di atas untuk berinteraksi
            </div>
        </center>
    </div>
        </div>

            <div class="review-box">
    <h3 style="color: #7385a5; margin-top: 0; display:flex; align-items:center; gap:10px;">
        <i class="fas fa-pen-nib"></i> Beri Rating
    </h3><br>
    
    <div class="star-rating" style="margin-bottom: 15px; font-size: 24px;">
        <input type="hidden" id="selectedStar" value="0">
        
        <i class="fas fa-star" onclick="pilihBintang(1)" id="star-1" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(2)" id="star-2" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(3)" id="star-3" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(4)" id="star-4" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(5)" id="star-5" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
    </div>
    <br>
    <div style="margin-bottom: 20px;">
        <p style="color:#7385a5; font-size:12px; margin-bottom:8px; font-weight:bold;">
            <i class="fas fa-tags"></i> Pilih Ulasan:
        </p>
        <div id="pilihanUlasan" style="display: flex; gap: 8px; flex-wrap: wrap;">
            <button class="chip" onclick="pilihTag(this, 'Luar Biasa')"><i class="fas fa-thumbs-up"></i> Luar Biasa</button>
            <button class="chip" onclick="pilihTag(this, 'Sangat Detail')"><i class="fas fa-search-plus"></i> Sangat Detail</button>
            <button class="chip" onclick="pilihTag(this, 'Estetik')"><i class="fas fa-palette"></i> Estetik</button>
            <button class="chip" onclick="pilihTag(this, 'Super')"><i class="fas fa-bolt"></i> Super</button>
            <button class="chip" onclick="pilihTag(this, 'Masterpiece')"><i class="fas fa-crown"></i> Masterpiece</button>
            <button class="chip" onclick="pilihTag(this, 'Bersejarah')"><i class="fas fa-history"></i> Bersejarah</button>
        </div>
        <input type="hidden" id="selectedTag" value="">
    </div>

    <button onclick="kirimUlasan()" class="btn-premium">
    <i class="fas fa-paper-plane"></i> Kirim Ulasan
    </button>
            </div>

    <div style="margin-top: 30px; margin-bottom: 50px;">
    <h3 style="color: #7385a5; display:flex; align-items:center; gap:10px;">
    <i class="fas fa-comments"></i> 
    Ulasan Pengunjung 
    (<span style="color: #00b300;" id="reviewCount">0</span>)
    </h3>
    
    <div id="reviewContainer" style="min-height: 50px;">
        <p style="color:#999; text-align:center; font-style:italic;">
            <i class="fas fa-spinner fa-spin"></i> Memuat data...
        </p>
    </div>
    </div>
</div>
</div>
</div>

    <div id="walletModal" class="modal-overlay" onclick="closeWalletModal(event)">
    <div class="modal-card">
    
    <div class="modal-header">
        <h3><i class="fas fa-wallet" style="color:#7385a5;"></i> Wallet Info</h3>
        <button class="close-btn" onclick="toggleWalletModal()"><i class="fas fa-times"></i></button>
    </div>

    <div class="modal-status">
        <span class="status-label">Status:</span>
        <div class="status-badge">
            <span class="pulse-dot"></span> Terhubung Base Network
        </div>
    </div>

    <div class="modal-balance">
        <div class="balance-label">Saldo Dompet Utama</div>
        <div class="balance-amount" id="modalBalance">
            <i class="fas fa-spinner fa-spin"></i> Loading...
        </div>

        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px dashed #d1d9e6;">
            <div class="balance-label" style="color:#888;">
                <i class="fas fa-gift"></i> Total Pendapatan Dukungan
            </div>
            <div class="balance-amount" id="modalTipBalance" style="font-size: 18px; color: #7385a5;">
                0.0000 ETH
            </div>
        </div>
    </div>

    <div class="modal-address-box" onclick="copyAddress()">
        <div class="address-text">
            <span id="modalFullAddress" style="display:none;"></span> 
            <span id="modalShortAddress">0x...</span>
        </div>
        <i class="far fa-copy copy-icon"></i>
    </div>

    <div class="modal-history-section">
        <h4 style="font-size:12px; color:#7385a5; margin:0 0 8px 0; display:flex; justify-content:space-between;">
            <span><i class="fas fa-history"></i> Riwayat Masuk</span>
            <span id="modalTipCountBadge" style="background:#eee; padding:2px 6px; border-radius:10px; font-size:10px;">0</span>
        </h4>
        
        <div id="modalHistoryList" class="history-scroll-area">
            <p style="text-align:center; font-size:11px; color:#aaa; margin-top:10px;">Belum ada riwayat.</p>
        </div>

        <button id="btnModalLoadMore" onclick="loadNextModalTips()" style="display:none; width:100%; margin-top:5px; background:none; border:1px dashed #7385a5; color:#7385a5; font-size:10px; padding:5px; cursor:pointer; border-radius:5px;">
            Muat 2 Lama <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <div class="modal-actions" style="margin-top: 15px;">
        <button class="action-btn primary" onclick="window.location.href='/profile'">
            <i class="fas fa-user-circle"></i> Buka Profil Saya
        </button>
        
        <button class="action-btn danger" onclick="disconnectWallet()">
            <i class="fas fa-sign-out-alt"></i> Putuskan Koneksi
        </button>
    </div>
    </div>
    </div>

    <div id="sawerModal" class="sawer-overlay" onclick="closeSawer(event)">
    <div class="sawer-card">
        <button class="sawer-close" onclick="toggleSawerModal(false)"><i class="fas fa-times"></i></button>
        <div class="network-indicator">
            <span class="pulse-green"></span>
            Terhubung Ke Jaringan Base
        </div>
        
    <center><div class="sawer-header">
            <h3>Dukung & Apresiasi Kreator Dengan ETH</h3>
        </div></center><br>

        <div class="sawer-info-box">
            <div class="info-row">
                <span class="label">Penerima:</span>
                <span class="value" id="sawerReceiverName" style="font-weight:bold;">Loading...</span>
            </div>
            <div class="info-row sub">
                <span class="label">Address:</span>
                <span class="value mono" id="sawerReceiverAddr">0x...</span>
            </div>
            <div class="divider"></div>
            <div class="info-row highlight">
                <span class="label">Saldo Anda:</span>
                <span class="value" id="sawerUserBalance">0.0000 ETH</span>
            </div>
        </div>

        <div class="input-group">
            <label>Nominal (ETH):</label>
            <div class="input-wrapper">
                <input type="number" id="sawerAmount" placeholder="0.001" step="0.0001" min="0.0001" max="0.005">
                <span class="suffix">ETH</span>
            </div>
            <small class="limit-info">Min: 0.0001 ETH â€¢ Max: 0.005 ETH</small>
        </div>

        <div class="percent-grid">
    <button onclick="setSawerPercent('MIN')">Min</button> 
    <button onclick="setSawerPercent(25)">25%</button>
    <button onclick="setSawerPercent(50)">50%</button>
    <button onclick="setSawerPercent(75)">75%</button>
    <button onclick="setSawerPercent(100)">MAX</button>
        </div>

        <div class="input-group" style="margin-top: 15px;">
    <label>Dukungan (Opsional)</label>

    <textarea id="sawerMessage" rows="2"></textarea>
        </div>

        <button id="btnKirimSawer" class="btn-sawer-send" onclick="eksekusiSawer()">
            <i class="fas fa-paper-plane"></i> Kirim Apresiasi
        </button>

    </div>
    </div>

    <div id="confirmDownloadModal" class="dl-overlay">
    <div class="dl-card">
        <div class="dl-icon-box">
            <i class="fas fa-file-image"></i>
        </div>
        <h3>Konfirmasi Download</h3>
        <p>Anda akan mendownload file sertifikat:</p>
        
        <div class="file-details">
            <span id="dlFileName" class="fname">cert_name.png</span>
            <span id="dlFileSize" class="fsize">0 MB</span>
        </div>

        <div class="dl-actions">
            <button class="btn-no" onclick="handleDownloadChoice(false)">Batal</button>
            <button class="btn-yes" onclick="handleDownloadChoice(true)">
                <i class="fas fa-download"></i>Simpan
            </button>
        </div>
    </div>
    </div>
            
<div id="toast"></div>

<footer class="footer">
        <div class="footer-content">
            <div class="social-icons">
                <a href="https://youtube.com/@PutramasOfficial" target="_blank" class="social-link"><i class="fab fa-youtube"></i></a>
                <a href="https://instagram.com/putramas_official" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                <a href="https://facebook.com/PutramasOfficial" target="_blank" class="social-link"><i class="fab fa-facebook-f"></i></a>
                <a href="https://facebook.com/PutramasOfficialStudio" target="_blank" class="social-link"><i class="fab fa-facebook-f"></i></a>
            </div>
            <p class="copyright">
                &copy; <span id="year"></span> Powered By <strong>Putramas Official</strong>
            </p>
        </div>
</footer>

<script>
    const CONTRACT_ADDRESS = "0x72359F776Ac4B44c6c79dBF805D79959515E0c58"; // <--- Paste Contract Address Disini
    
    const BASE_SEPOLIA_ID = '0x2105'; // 8453
    const BASE_SEPOLIA_RPC = 'https://base-rpc.publicnode.com';
    const BASE_SEPOLIA_CONFIG = {
        chainId: BASE_SEPOLIA_ID,
        chainName: 'Base Sepolia Testnet',
        nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
        rpcUrls: [BASE_SEPOLIA_RPC],
        blockExplorerUrls: ['https://basescan.org']
    };

    const CONTRACT_ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"FeeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"}],"name":"Liked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"star","type":"uint8"},{"indexed":false,"internalType":"string","name":"ulasan","type":"string"}],"name":"Reviewed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"RevisionFeeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"string","name":"message","type":"string"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"TipSent","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"nama","type":"string"},{"indexed":false,"internalType":"string","name":"golongan","type":"string"}],"name":"WayangLahir","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"nama","type":"string"},{"indexed":false,"internalType":"string","name":"golongan","type":"string"},{"indexed":false,"internalType":"bool","name":"isOfficial","type":"bool"},{"indexed":false,"internalType":"address","name":"creator","type":"address"}],"name":"WayangLahir","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"namaBaru","type":"string"},{"indexed":false,"internalType":"string","name":"uriBaru","type":"string"}],"name":"WayangUpdate","type":"event"},{"inputs":[],"name":"MAX_TIP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_TIP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_penerima","type":"address"},{"internalType":"string","name":"_tokenURI","type":"string"},{"internalType":"string","name":"_nama","type":"string"},{"internalType":"string","name":"_golongan","type":"string"},{"internalType":"string","name":"_gaya","type":"string"}],"name":"arsipWayang","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"dalang","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"emergencyWithdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getAverageRating","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"golongan","type":"string"}],"name":"getIdsByGolongan","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getInfoWayang","outputs":[{"components":[{"internalType":"string","name":"nama","type":"string"},{"internalType":"string","name":"golongan","type":"string"},{"internalType":"string","name":"gaya","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"},{"internalType":"bool","name":"isOfficial","type":"bool"},{"internalType":"address","name":"creator","type":"address"}],"internalType":"struct WayangArsipPutramas.WayangInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getReviews","outputs":[{"components":[{"internalType":"address","name":"reviewer","type":"address"},{"internalType":"uint8","name":"bintang","type":"uint8"},{"internalType":"string","name":"ulasan","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct WayangArsipPutramas.Review[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getTipByIndex","outputs":[{"components":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"string","name":"message","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct WayangArsipPutramas.TipRecord","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getTipCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getTipTotalBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"hasLiked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"hasReviewed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"kasihLike","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"_bintang","type":"uint8"},{"internalType":"string","name":"_ulasanPilihan","type":"string"}],"name":"kasihUlasan","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicMintFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"string","name":"_namaBaru","type":"string"},{"internalType":"string","name":"_uriBaru","type":"string"}],"name":"revisiDataWayang","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_id","type":"uint256"},{"internalType":"string","name":"_namaBaru","type":"string"},{"internalType":"string","name":"_uriBaru","type":"string"}],"name":"revisiWayang","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"revisionFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"_receiver","type":"address"},{"internalType":"string","name":"_message","type":"string"}],"name":"sendTip","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newFee","type":"uint256"}],"name":"setMintFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newFee","type":"uint256"}],"name":"setRevisionFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"totalLikes","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalReceived","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalTipsGrand","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_tokenURI","type":"string"},{"internalType":"string","name":"_nama","type":"string"},{"internalType":"string","name":"_golongan","type":"string"},{"internalType":"string","name":"_gaya","type":"string"}],"name":"uploadPublik","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"walletOfOwner","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"wayangRegistry","outputs":[{"internalType":"string","name":"nama","type":"string"},{"internalType":"string","name":"golongan","type":"string"},{"internalType":"string","name":"gaya","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"},{"internalType":"bool","name":"isOfficial","type":"bool"},{"internalType":"address","name":"creator","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"wayangReviews","outputs":[{"internalType":"address","name":"reviewer","type":"address"},{"internalType":"uint8","name":"bintang","type":"uint8"},{"internalType":"string","name":"ulasan","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"}];
        
    let provider;
    let signer;
    let toastTimeout;
    let sawerTargetAddress = null;
    let pendingDownloadData = null;
    let modalTipCursor = 0;      // Penanda index untuk modal
let modalUserAddr = null;    // Alamat user yang sedang login
let isModalFetching = false; // Kunci loading
    const MIN_TIP = 0.0001;
    const MAX_TIP = 0.005;

    async function init() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (!id) {
            document.getElementById("loading").innerText = "Gagal: ID Arsip tidak ditemukan.";
            return;
        }

        if(window.ethereum && window.ethereum.selectedAddress) {
             connectWallet();
        }

        await loadDetail(id);
        await loadSocialData(id);
    }

    async function connectWallet() {
    const btn = document.getElementById("btn-connect");

    // 1. CEK: Jika sudah connect, klik tombol ini fungsinya membuka Modal
    if (btn.classList.contains("connected")) {
        toggleWalletModal();
        return;
    }

    // 2. Validasi Metamask
    if (!window.ethereum) return showToast("Install Metamask Atau EVM Wallet Dulu!", 'wolf');

    try {
        // Setup Provider
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        
        // Cek Network
        const network = await provider.getNetwork();
        if (network.chainId !== 84532) {
            await switchNetwork();
        }

        // Setup Signer & Address
        signer = provider.getSigner();
        const address = await signer.getAddress();
        
        // Simpan ke global variable (penting untuk fitur lain)
        userAddress = address; 

        // --- UPDATE UI TOMBOL UTAMA ---
        // Menggunakan innerHTML agar bisa pakai Icon
        btn.innerHTML = `<i class="fas fa-wallet"></i> Info Profile`;
        btn.classList.add("connected");

        // --- ISI DATA KE DALAM MODAL (PREPARE) ---
        // Masukkan alamat lengkap & pendek ke elemen modal
        document.getElementById("modalFullAddress").innerText = address;
        document.getElementById("modalShortAddress").innerText = address.substring(0, 10) + "..." + address.substring(35);

        // Ambil Saldo & Format (4 desimal)
        const balance = await provider.getBalance(address);
        const ethBalance = ethers.utils.formatEther(balance);
        document.getElementById("modalBalance").innerText = parseFloat(ethBalance).toFixed(4) + " ETH";

        // Reload Galeri (Opsional, jika ada fungsi ini)
        if (typeof loadGaleri === "function") {
            loadGaleri();
        }

        await updateModalWalletData(address);

        showToast("Berhasil terhubung!", 'success');

    } catch (err) {
        console.error(err);
        showToast("Gagal koneksi: " + err.message, 'error');
    }
}

    async function switchNetwork() {
        try {
            await window.ethereum.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: BASE_SEPOLIA_ID }],
            });
        } catch (switchError) {
            if (switchError.code === 4902) {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [BASE_SEPOLIA_CONFIG],
                });
            } else {
                throw switchError;
            }
        }
    }

    // Fungsi Buka/Tutup Modal
function toggleWalletModal() {
    const modal = document.getElementById("walletModal");
    if (modal.classList.contains("active")) {
        modal.classList.remove("active");
        setTimeout(() => modal.style.display = "none", 300);
    } else {
        modal.style.display = "flex";
        setTimeout(() => modal.classList.add("active"), 10);
        if (typeof userAddress !== 'undefined' && userAddress) {
            updateModalWalletData(userAddress);
        }
    }
}

// Fungsi Tutup jika klik area gelap
function closeWalletModal(e) {
    if (e.target.id === "walletModal") toggleWalletModal();
}

// Fungsi Copy Address
function copyAddress() {
    const fullAddress = document.getElementById("modalFullAddress").innerText;
    navigator.clipboard.writeText(fullAddress).then(() => {
        showToast("Alamat Wallet disalin!", 'success'); // Atau ubah icon ceklis
    });
}

// Fungsi Disconnect (Reset UI)
function disconnectWallet() {
    userAddress = null;
    signer = null;
    
    const btn = document.getElementById("btn-connect");
    btn.innerHTML = `<i class="fas fa-wallet"></i> Hubungkan`;
    btn.classList.remove("connected");
    
    toggleWalletModal();
    window.location.reload(); // Refresh halaman agar bersih
}

// 1. FUNGSI UPDATE DATA MODAL (Panggil ini saat Toggle Modal / Connect)
async function updateModalWalletData(userAddress) {
    if(!userAddress) return;
    modalUserAddr = userAddress;

    // Reset UI
    document.getElementById("modalHistoryList").innerHTML = `<div style="text-align:center; padding:10px;"><i class="fas fa-spinner fa-spin"></i></div>`;
    document.getElementById("btnModalLoadMore").style.display = 'none';

    try {
        const rpcProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, rpcProvider);

        // A. AMBIL TOTAL PENDAPATAN (getTipTotalBalance)
        const totalWei = await contract.getTipTotalBalance(userAddress);
        const totalEth = parseFloat(ethers.utils.formatEther(totalWei)).toFixed(4);
        document.getElementById("modalTipBalance").innerText = totalEth + " ETH";

        // B. AMBIL JUMLAH HISTORY (getTipCount)
        const countBN = await contract.getTipCount(userAddress);
        const count = parseInt(countBN);
        document.getElementById("modalTipCountBadge").innerText = count;

        if (count === 0) {
            document.getElementById("modalHistoryList").innerHTML = `<p style="text-align:center; font-size:11px; color:#aaa; margin-top:10px;">Belum ada riwayat masuk.</p>`;
            return;
        }

        // C. SIAPKAN BATCH PERTAMA (Reverse Order)
        modalTipCursor = count - 1; // Mulai dari yang terbaru
        document.getElementById("modalHistoryList").innerHTML = ""; // Bersihkan loader
        
        await loadNextModalTips(); // Load 5 pertama

    } catch (e) {
        console.error("Gagal update modal data:", e);
    }
}

// 2. FUNGSI LOAD BATCH MODAL (5 Item per klik)
async function loadNextModalTips() {
    if(isModalFetching || modalTipCursor < 0) return;
    
    isModalFetching = true;
    const container = document.getElementById("modalHistoryList");
    const btnMore = document.getElementById("btnModalLoadMore");
    
    // Matikan tombol sementara
    if(btnMore) btnMore.innerHTML = "Memuat...";

    const rpcProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
    const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, rpcProvider);

    // Hitung mundur 5 langkah
    let end = modalTipCursor - 2 + 1;
    if(end < 0) end = 0;

    let html = "";

    for (let i = modalTipCursor; i >= end; i--) {
        try {
            const tip = await contract.getTipByIndex(modalUserAddr, i);
            
            // Format Data
            const senderShort = tip.sender.substring(0,4) + ".." + tip.sender.substring(38);
            const amount = parseFloat(ethers.utils.formatEther(tip.amount)).toFixed(4);
            const msg = tip.message || "Tanpa pesan";

            html += `
            <div class="mini-history-item">
                <div>
                    <div class="mini-sender"><i class="fas fa-user-circle"></i> ${senderShort}</div>
                    <span class="mini-msg">"${msg}"</span>
                </div>
                <div class="mini-amount">+${amount} ETH</div>
            </div>`;
        } catch (e) {}
    }

    // Append (Tempel ke bawah)
    container.insertAdjacentHTML('beforeend', html);

    // Update Status
    modalTipCursor = end - 1;
    isModalFetching = false;

    // Cek Tombol Load More
    if(btnMore) {
        if(modalTipCursor >= 0) {
            btnMore.style.display = 'block';
            btnMore.innerHTML = `Muat 2 Lama <i class="fas fa-chevron-down"></i>`;
        } else {
            btnMore.style.display = 'none'; // Data habis
        }
    }
}

        async function loadDetail() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    // SENJATA BARU ANDA:
    const DEDICATED_GATEWAY = "https://magenta-secondary-guan-686.mypinata.cloud";

    if (!id) return;

    try {
        const provider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);

        // 1. Ambil Owner & Data (DIUBAH KE DEDICATED)
        const owner = await contract.ownerOf(id);
        updateSawerCount(owner);
        currentDetailOwner = owner;
        const uri = await contract.tokenURI(id);
        
        // Ganti ipfs.io dengan Dedicated Gateway Anda untuk JSON Metadata
        const httpUri = uri.replace("ipfs://", `${DEDICATED_GATEWAY}/ipfs/`);
        const response = await axios.get(httpUri);
        const meta = response.data;
        currentDetailName = meta.name;

        // 2. Cek User Address (Logika Anda tetap sama)
        if (window.ethereum) {
            const accounts = await window.ethereum.request({ method: 'eth_accounts' });
            if (accounts.length > 0) userAddress = accounts[0];
        }
        
        // Ganti ipfs.io dengan Dedicated Gateway Anda untuk Gambar Utama
        const rawImgUrl = meta.image.replace("ipfs://", `${DEDICATED_GATEWAY}/ipfs/`);
        
        // Optimasi Gambar HD tetap menggunakan weserv tapi sumbernya dari Gateway VIP Anda
        const hdImageUrl = `https://wsrv.nl/?url=${encodeURIComponent(rawImgUrl)}&w=1200&q=95&output=webp`;

        // --- SISANYA TETAP MENGGUNAKAN KODE LENGKAP ANDA ---
        const getAttr = (k) => {
            if(!meta.attributes) return "-";
            const f = meta.attributes.find(a => a.trait_type.toLowerCase() === k.toLowerCase());
            return f ? f.value : "-";
        };

        document.getElementById("displayId").innerText = id;
        
        const imgEl = document.getElementById("displayImg");
        imgEl.src = hdImageUrl;
        // Fallback jika weserv bermasalah
        imgEl.onerror = () => { imgEl.src = rawImgUrl; };
        
        imgEl.style.opacity = 0;
        imgEl.onload = () => { imgEl.style.opacity = 1; imgEl.style.transition = "opacity 0.5s"; };

        document.getElementById("displayName").innerText = meta.name;
        
        // ... (Lanjutkan dengan semua logika Badge, Gaya, dan Silsilah milik Anda) ...
        document.getElementById("displayGaya").innerText = getAttr("Gaya");

        // --- UPDATE UI STANDAR PROFESIONAL (FIXED VERSION) ---

        // 1. Definisikan Elemen Target
        const titleElement = document.getElementById('displayName'); 

        // 2. Siapkan Data User (AMBIL LANGSUNG DARI METAMASK BIAR TIDAK ERROR)
        let currentUser = "";
        try {
            if (window.ethereum && window.ethereum.selectedAddress) {
                currentUser = window.ethereum.selectedAddress;
            }
        } catch (e) { console.log("Wallet belum connect"); }

        const shortOwner = owner.substring(0, 6) + "..." + owner.substring(owner.length - 4);

        // --- 6. PINDAHKAN BADGE GAYA (CIREBON) KE HEADER ---
        
        // A. Ambil Text Gaya (Misal: "Cirebon")
        const textGaya = getAttr("Gaya");

        if (textGaya) {
            // B. Sembunyikan Elemen Gaya yang Lama (yang ada di bawah)
            // Supaya tidak muncul double
            const oldGayaEl = document.getElementById("displayGaya");
            if (oldGayaEl) {
                // Sembunyikan elemen ini (atau parent-nya jika perlu)
                oldGayaEl.style.display = 'none'; 
                
                // Opsional: Jika displayGaya ada di dalam container khusus (misal .badge-container), sembunyikan container itu juga
                if(oldGayaEl.parentElement && oldGayaEl.parentElement.className.includes('badge')) {
                     oldGayaEl.parentElement.style.display = 'none';
                }
            }

            // C. Buat HTML Badge Gaya Baru (Style Pill Biru Elegan)
            const newGayaBadge = `
                <span title="Gaya / Asal" 
                      style="background:#5c6a84; color:white; padding:4px 12px; border-radius:50px; 
                             font-size:11px; font-weight:600; vertical-align:middle; margin-left:8px; 
                             display:inline-flex; align-items:center; border:1px solid rgba(255,255,255,0.2); 
                             transform:translateY(-1px);">
                    <i class="fas fa-map-marker-alt" style="margin-right:4px; font-size:10px;"></i> ${textGaya}
                </span>
            `;

            // D. Masukkan ke dalam Judul (displayName)
            // 'beforeend' artinya ditaruh di urutan paling akhir di dalam H2 (Setelah Teks Judul & Bintang)
            document.getElementById("displayName").insertAdjacentHTML('beforeend', newGayaBadge);
        }
        
        // Cek Pemilik
        const isMyItem = (currentUser && currentUser.toLowerCase() === owner.toLowerCase());

        // 3. Buat HTML Badge Kontributor (Di Bawah Judul)
        const ownerCardHTML = `
            <div class="owner-stat-card">
                
                <div class="owner-header-row">
                    <a href="profile?address=${owner}" class="owner-profile-link">
                        <img src="https://api.dicebear.com/7.x/identicon/svg?seed=${owner}" 
                             style="width:38px; height:38px; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                        <div>
                            <span style="font-size:10px; color:#888; display:block; margin-bottom:2px;">DIMILIKI OLEH</span>
                            <span style="font-size:14px; font-weight:700; color:#5c6a84;">${shortOwner}</span>
                        </div>
                    </a>
                    
                    ${isMyItem ? `
                        <span style="font-size:10px; background:#fff8e1; color:#f1c40f; padding:5px 12px; border-radius:20px; border:1px solid #ffe082; font-weight:bold;">
                            <i class="fas fa-user-check"></i> Milik Anda
                        </span>
                    ` : `
                        <a href="profile?address=${owner}" style="font-size:11px; color:#7385a5; text-decoration:none; font-weight:600;">
                            Lihat Profil <i class="fas fa-chevron-right" style="font-size:9px;"></i>
                        </a>
                    `}
                </div>

                <div class="owner-stats-row">
                    <div class="stat-item-col" style="border-right: 1px dashed #ddd;">
                        <div class="stat-icon-circle" style="background:#e9f0ff; color:#7385a5; border: 1px solid #7385a5;">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-text-group">
                            <span class="stat-label-mini">Total Dukungan</span>
                            <span id="stat-earnings" class="stat-value-bold">...</span>
                        </div>
                    </div>

                    <div class="stat-item-col">
                        <div class="stat-icon-circle" style="background:#e9f0ff; color:#7385a5; border: 1px solid #7385a5;">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-text-group">
                            <span class="stat-label-mini">Pendukung</span>
                            <span id="stat-supporters" class="stat-value-bold">...</span>
                        </div>
                    </div>
                </div>

            </div>`;

        // 4. Buat HTML Tombol Revisi (Icon Only)
        const editIconHTML = `
            <button onclick="handleEditClick('${id}', '${owner}')" title="Revisi Data"
                style="background:#d35400; padding:4px 12px; border:2px solid #d35400; border-radius:50px; cursor:pointer; color:#fff; font-size:11px; font-weight:600; margin-left:10px; vertical-align:middle; transition:0.2s;"
                onmouseover="this.style.transform='scale(1.1)'" 
                onmouseout="this.style.transform='scale(1)'">
                <i class="fas fa-pen-to-square"></i> Revisi
            </button>
        `;

        // 5. EKSEKUSI RENDER (PERBAIKAN DISINI)
        
        // A. Masukkan Owner Card (UNTUK SEMUA ORANG)
        // Kita keluarkan dari logika 'isMyItem' agar pengunjung juga bisa lihat profil pemilik
        if (!document.querySelector('.owner-stat-card')) {
            titleElement.insertAdjacentHTML('afterend', ownerCardHTML);
        }

        // B. Panggil Data Statistik (UNTUK SEMUA ORANG)
        loadOwnerStats(owner);

        // C. Masukkan Tombol Edit (HANYA UNTUK PEMILIK)
        if (isMyItem) {
            // Cek apakah tombol sudah ada? Kalau belum, masukkan ke dalam judul
            if (!titleElement.querySelector('button')) {
                titleElement.insertAdjacentHTML('beforeend', editIconHTML);
            }
        }
        
        // --- LANJUT DATA LAINNYA ---
        document.getElementById("displayDesc").innerText = meta.description;
        document.getElementById("displayGolongan").innerText = getAttr("Golongan");
        document.getElementById("displayWanda").innerText = getAttr("Wanda");
        document.getElementById("displayKulit").innerText = getAttr("Material Kulit");
        document.getElementById("displayGapit").innerText = getAttr("Material Gapit");
        document.getElementById("displayPenatah").innerText = getAttr("Penatah");
        document.getElementById("displayPenyungging").innerText = getAttr("Penyungging");
        document.getElementById("displayTahun").innerText = getAttr("Tahun Pembuatan");
        document.getElementById("displayKolektor").innerText = getAttr("Kolektor");
        
        document.getElementById("displayNegara").innerText = getAttr("Negara");
        document.getElementById("displayAyah").innerText = getAttr("Ayah");
        document.getElementById("displayIbu").innerText = getAttr("Ibu");
        document.getElementById("displayPusaka").innerText = getAttr("Pusaka") || "-";

/* BARU V3.2 */  
const currentGolongan = getAttr("Golongan");
const currentGaya = getAttr("Gaya");
// --- EKSEKUSI FITUR REKOMENDASI ---
// Ini akan otomatis mencari wayang lain di blockchain
loadRelatedWayang(id, currentGolongan, currentGaya);
        
        document.getElementById("loading").style.display = "none";
        document.getElementById("content").style.display = "flex";

    } catch (err) {
        console.error("Error Detail:", err);
        document.getElementById("loading").innerText = "Gagal memuat data wayang. Cek koneksi.";
    }
} // Tutup kurung fungsi loadDetail

  async function loadOwnerStats(ownerAddress) {
    try {
        // Gunakan RPC Publik (Cepat & Gratis)
        const rpcProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const readContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, rpcProvider);

        // 1. Ambil Total Pendapatan
        const totalWei = await readContract.getTipTotalBalance(ownerAddress);
        const totalEth = parseFloat(ethers.utils.formatEther(totalWei)); // Tanpa toFixed dulu biar presisi

        // 2. Ambil Jumlah Pendukung
        const countBN = await readContract.getTipCount(ownerAddress);
        const count = parseInt(countBN);

        // 3. Update UI
        const elEarn = document.getElementById("stat-earnings");
        const elSupp = document.getElementById("stat-supporters");

        if (elEarn) elEarn.innerText = totalEth > 0 ? totalEth.toFixed(4) + " ETH" : "0 ETH";
        if (elSupp) elSupp.innerText = count + " Orang";

    } catch (e) {
        console.warn("Gagal load stats:", e);
    }
  }

    // Fungsi Handler Klik Tombol Revisi
function handleEditClick(id, owner) {
    // 1. Cek apakah Wallet sudah terhubung
    if (!userAddress) {
        showToast("Hubungkan wallet untuk mengedit!", 'warning');
        return;
    }

    // 2. Cek apakah Wallet yang login adalah Pemilik
    if (userAddress.toLowerCase() !== owner.toLowerCase()) {
        showToast("Anda bukan pemilik postingan ini!", 'error');
        return;
    }

    // 3. Jika Lolos Validasi -> Pindah ke Halaman Revisi
    window.location.href = `revisi?id=${id}`;
}

    async function loadSocialData(id) {
    try {
        const readProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, readProvider);
        
        // 1. Load Likes
        const likes = await contract.totalLikes(id);
        const likeEl = document.getElementById("likeCount");
        if(likeEl) likeEl.innerText = likes.toString();
        
        // 2. Load Reviews
        const reviews = await contract.getReviews(id);
        
        // --- RATING RATA-RATA (FIX DUPLIKAT) ---
        try {
            const avgScore = await contract.getAverageRating(id);
            const finalScore = (avgScore / 10).toFixed(1);
            
            if(avgScore > 0) {
                const nameEl = document.getElementById("displayName");
                
                // 1. Cek apakah badge rating sudah ada?
                let ratingBadge = document.getElementById("rating-badge-dynamic");

                // 2. Jika BELUM ada, kita buat element baru
                if (!ratingBadge) {
                    ratingBadge = document.createElement("span");
                    ratingBadge.id = "rating-badge-dynamic"; // Kasih ID biar dikenali
                    
                    // Style CSS (Sama seperti sebelumnya)
                    ratingBadge.style.cssText = "font-size:14px; color:#f1c40f; border:1px solid #f1c40f; padding:2px 8px; border-radius:15px; display:inline-flex; align-items:center; gap:4px; vertical-align: middle; margin-left: 10px;";
                    
                    // Masukkan ke sebelah Nama
                    nameEl.appendChild(ratingBadge);
                }

                // 3. Update Isinya (Baik itu baru dibuat atau sudah ada)
                // Ini menjamin isinya cuma satu dan angkanya selalu update
                ratingBadge.innerHTML = `<i class="fas fa-star"></i> ${finalScore}`;
            }
        } catch (e) {
            console.log("Belum ada rating rata-rata");
    }
        
        // Update Jumlah Review
        const countEl = document.getElementById("reviewCount");
        if(countEl) countEl.innerText = reviews.length;
        
        const container = document.getElementById("reviewContainer");
        
        // --- LOOPING ULASAN ---
        if(reviews.length === 0) {
            container.innerHTML = `<p style="color:#666; font-style: italic; text-align:center; padding:20px;">
                <i class="far fa-comment-dots"></i> Belum ada ulasan. Jadilah yang pertama!
            </p>`;
        } else {
            container.innerHTML = ""; // Bersihkan loading
            [...reviews].reverse().forEach(r => {
                const bintangHtml = '<i class="fas fa-star" style="margin-right:2px;"></i>'.repeat(r.bintang);
                
                // PERBAIKAN: Hapus style inline di div utama agar class .review-card dari CSS terpakai
                const addr = r.reviewer; // Mendapatkan alamat untuk seed avatar
const identiconUrl = `https://api.dicebear.com/7.x/identicon/svg?seed=${addr}&backgroundColor=7385a5`;

const html = `
    <div class="review-card"> 
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; border-bottom:1px dashed #ccc; padding-bottom:5px;">
            <div style="font-size: 12px; font-weight:bold;">
                <a href="profile?address=${r.reviewer}" title="Kunjungi Profil"
                   style="color: #5c6a84; text-decoration: none; display: flex; align-items: center; gap: 8px; transition: color 0.2s;"
                   onmouseover="this.style.color='#2980b9'"
                   onmouseout="this.style.color='#5c6a84'">
                    
                    <img src="${identiconUrl}" 
                         style="width: 22px; height: 22px; border-radius: 50%; border: 1px solid #7385a5; background: #fff; flex-shrink: 0;" 
                         alt="Avatar">

                    <span>
                        <i class="fas fa-user-circle" style="font-size: 10px; opacity: 0.7;"></i> 
                        ${r.reviewer.substring(0,6)}...${r.reviewer.substring(38)}
                    </span>
                </a>
            </div>
            <div style="color: #f1c40f; font-size: 12px;">${bintangHtml}</div>
        </div>
        <div style="color: #444; font-size: 13px; line-height: 1.4;">
            <i class="fas fa-quote-left" style="color:#ccc; font-size:10px; vertical-align:top; margin-right:5px;"></i> 
            ${r.ulasan}
        </div>
    </div>
`;
container.innerHTML += html;
            });
        loadSocialData(id);
    }

    } catch (err) {
        console.error("Gagal load social:", err);
    }
        }
    
    async function ensureWallet() {
        if(!signer) {
            await connectWallet();
            if(!signer) throw new Error("Wallet belum terkoneksi");
        }
    }

    async function kirimLike() {
        try {
            await ensureWallet();
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
            
            const btn = document.getElementById("btnLike");
            const oriText = btn.innerHTML;
            btn.innerHTML = `
            <i class="fas fa-circle-notch fa-spin" style="margin-right: 8px;"></i>
           `;
            const tx = await contract.kasihLike(id);
            await tx.wait();
            
            showToast("Berhasil Like!", 'success');
            location.reload();

        } catch(err) {
            showToast("Gagal: " + (err.reason || err.message), 'error');
            document.getElementById("btnLike").innerHTML = '<i class="fas fa-times" style="color: #ff3333; margin-right: 6px;"></i>';
        }
    }

    async function kirimUlasan() {
        try {
            const bintang = document.getElementById("selectedStar").value;
            const tag = document.getElementById("selectedTag").value;
            if(bintang == 0 || tag == "") return showToast("Pilih bintang & kata ulasan dulu!", 'warning');

            await ensureWallet();
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
            
            const tx = await contract.kasihUlasan(id, bintang, tag);
            showToast("Transaksi review dikirim. Tunggu konfirmasi...", 'loading');
            await tx.wait();
            
            showToast("Review Berhasil!", 'success');
            location.reload();

        } catch(err) {
            showToast("Gagal: " + (err.reason || err.message), 'error');
        }
    }

    function pilihBintang(n) {
    // 1. Simpan nilai ke input hidden
    document.getElementById("selectedStar").value = n;

    // 2. Ambil semua elemen 'i' (icon), BUKAN 'span'
    const stars = document.querySelectorAll('.star-rating i');

    // 3. Loop untuk ubah warna
    stars.forEach((s, index) => {
        if(index < n) {
            // Jika urutan bintang di bawah n, warnai Emas
            s.style.color = "#f1c40f"; 
        } else {
            // Sisanya warnai Abu-abu
            s.style.color = "#ccc"; 
        }
    });
    }

    function pilihTag(btn, teks) {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
        btn.classList.add('selected');
        document.getElementById("selectedTag").value = teks;
    }

    async function smartShare() {
    const shareData = {
        title: document.title,
        text: 'Lihat koleksi Wayang Nusantara ini! Sangat detail dan estetik.',
        url: window.location.href
    };

    const btnShare = document.getElementById("btnShare");
    const originalText = btnShare.innerHTML;

    if (navigator.share) {
        try {
            await navigator.share(shareData);
            console.log('Berhasil dibagikan');
        } catch (err) {
            console.log('Batal membagikan');
        }
    } else {
        try {
            await navigator.clipboard.writeText(window.location.href);
            btnShare.innerHTML = `<img src="img/success.svg" style="width: 19px; height: 19px; vertical-align: middle;"> Link Disalin!`;
            setTimeout(() => {
                btnShare.innerHTML = originalText;
            }, 2000);
        } catch (err) {
            showToast("Gagal menyalin link: " + err, 'error');
        }
    }
    }

    // --- FUNGSI ZOOM PREMIUM ---

function openZoom(element) {
    const modal = document.getElementById("myZoomModal");
    const modalImg = document.getElementById("img01");
    
    // 1. Set Sumber Gambar
    modalImg.src = element.src; 
    
    // 2. Tampilkan Modal (Flex agar centering jalan)
    modal.style.display = "flex"; 
    
    // 3. Kunci Scroll Body (Biar gak goyang)
    document.body.classList.add("modal-open");

    // 4. Trigger Animasi (Sedikit delay agar transisi jalan)
    setTimeout(() => {
        modal.classList.add("active");
    }, 10);
}

function closeZoom() {
    const modal = document.getElementById("myZoomModal");
    
    // 1. Hilangkan Animasi
    modal.classList.remove("active");
    
    // 2. Tunggu animasi selesai baru sembunyikan (300ms sesuai CSS transition)
    setTimeout(() => {
        modal.style.display = "none";
        // 3. Lepas Kunci Scroll Body
        document.body.classList.remove("modal-open");
    }, 300);
}

async function downloadSertifikatHD() {
    const btn = document.getElementById("btnDownloadHD");
    const originalText = btn.innerHTML;
    
    // 1. Ubah tombol jadi Loading (Sedang memproses gambar...)
    btn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i>`;
    btn.disabled = true;

    try {
        // --- PROSES GENERATE (Sama seperti sebelumnya) ---
        const nama = document.getElementById("displayName").innerText;
        const imgElement = document.getElementById("displayImg");
        const tokenId = document.getElementById("displayId").innerText;
        const ownerInfo = document.querySelector("#contributor-badge-area span")?.innerText || "Putramas Collector";
        
        // Ambil URL Gambar Asli
        const rawImgUrl = imgElement.src.split('?url=')[1] ? decodeURIComponent(imgElement.src.split('?url=')[1].split('&')[0]) : imgElement.src;

        const wrapper = document.createElement("div");
        wrapper.style.position = "fixed"; wrapper.style.left = "-9999px"; wrapper.style.top = "0";

        // Template Sertifikat (Persis kode Mas)
        wrapper.innerHTML = `
            <div id="cert-hd" style="width:1000px; background: linear-gradient(180deg, #f9fbff, #f3f6fc); padding:70px; border-radius:18px; border:28px solid #7385a5; box-shadow: 0 30px 80px rgba(0,0,0,0.18), inset 0 0 0 1px rgba(255,255,255,0.6); position:relative; font-family:'Rubik', sans-serif;">
                <div style="border:1.5px solid rgba(211,84,0,0.65); border-radius:14px; padding:50px; background: #ffffff; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);">
                    <h1 style="color:#7385a5; font-size:52px; margin:0; letter-spacing:6px; font-weight:600;">CERTIFICATE OF AUTHENTICITY</h1>
                    <div style="height:2px; width:120px; background:linear-gradient(90deg,#7385a5,#d35400); margin:18px 0 12px;"></div>
                    <p style="color:#8a8f9c; text-transform:uppercase; letter-spacing:3px; font-size:13px; margin:0 0 40px;">Digital Heritage Archive â€¢ Wayang Nusantara</p>
                    <div style="width:100%; height:600px; margin:40px 0; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(115,133,165,0.08), rgba(255,255,255,0.9)); border-radius:14px; border:1px solid rgba(115,133,165,0.25); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.7), 0 15px 40px rgba(0,0,0,0.08); overflow:hidden;">
                        <img src="${rawImgUrl}" crossorigin="anonymous" style="max-width:92%; max-height:92%; object-fit:contain; filter: drop-shadow(0 10px 18px rgba(0,0,0,0.15));">
                    </div>
                    <h2 style="font-size:46px; color:#2c3e50; margin:15px 0 6px; font-weight:600;">${nama}</h2>
                    <p style="font-size:17px; color:#7385a5; letter-spacing:1px; margin:0 0 30px;">Token ID â€¢ <strong>#${tokenId}</strong></p>
                    <div style="margin:35px auto 0; width:82%; border-top:1px dashed rgba(115,133,165,0.35); padding-top:22px; text-align:center;">
                        <p style="font-size:13px; color:#888; letter-spacing:2px; margin-bottom:6px;">REGISTERED OWNER</p>
                        <p style="font-size:20px; color:#5c6a84; font-family:monospace; margin:0;">${ownerInfo}</p>
                    </div>
                    <div style="margin-top:55px; display:flex; justify-content:center; align-items:center; gap:22px;">
                        <img src="img/icon-192.png" style="width:78px; height:78px; border-radius:50%; box-shadow:0 6px 18px rgba(0,0,0,0.18);">
                        <div style="text-align:left;">
                            <p style="font-weight:600; color:#7385a5; margin:0; font-size:20px; letter-spacing:1px;">PUTRAMAS OFFICIAL</p>
                            <p style="color:#777; margin:2px 0 0; font-size:14px;">Verified On-Chain â€¢ Base Mainnet</p>
                        </div>
                    </div>
                </div>
            </div>`;
        
        document.body.appendChild(wrapper);

        // Tunggu gambar load
        const certImg = wrapper.querySelector('img');
        await new Promise((resolve) => {
            if (certImg.complete) resolve();
            certImg.onload = resolve;
            certImg.onerror = resolve; 
        });

        // Convert ke Canvas & DataURL
        const canvas = await html2canvas(document.getElementById("cert-hd"), {
            useCORS: true, scale: 2, backgroundColor: "#ffffff"
        });

        const dataUrl = canvas.toDataURL("image/png", 1.0);
        
        // --- MENGHITUNG UKURAN FILE (ESTIMASI DARI STRING BASE64) ---
        // Rumus: (Panjang String * (3/4)) - padding = Bytes
        const sizeInBytes = Math.ceil((dataUrl.length * 3) / 4); 
        const sizeInMB = (sizeInBytes / (1024 * 1024)).toFixed(2); // Convert ke MB (2 desimal)
        const fileName = `WayangNusantara_Sertifikat_${nama}_${tokenId}.png`;

        // Simpan data untuk diproses nanti saat tombol "YA" diklik
        pendingDownloadData = { url: dataUrl, name: fileName };

        // 2. Kembalikan tombol ke semula
        document.body.removeChild(wrapper);
        btn.innerHTML = originalText;
        btn.disabled = false;

        // 3. TAMPILKAN POPUP KONFIRMASI
        document.getElementById("dlFileName").innerText = fileName;
        document.getElementById("dlFileSize").innerText = sizeInMB + " MB";
        
        const modal = document.getElementById("confirmDownloadModal");
        modal.style.display = "flex";
        setTimeout(() => modal.classList.add("active"), 10); // Animasi Fade In

    } catch (err) {
        console.error("Gagal generate:", err);
        btn.innerHTML = originalText;
        btn.disabled = false;
        alert("Gagal memproses gambar. Coba lagi.");
    }
}

// FUNGSI HANDLE PILIHAN USER (YA / TIDAK)
function handleDownloadChoice(isYes) {
    const modal = document.getElementById("confirmDownloadModal");
    
    if (isYes && pendingDownloadData) {
        // Eksekusi Download
        const link = document.createElement("a");
        link.download = pendingDownloadData.name;
        link.href = pendingDownloadData.url;
        link.click();
    }

    // Tutup Modal & Reset Data
    modal.classList.remove("active");
    setTimeout(() => {
        modal.style.display = "none";
        pendingDownloadData = null; // Bersihkan memori
    }, 300);
}

// ==========================================
// 1. FUNGSI UTAMA: PANGGIL POPUP (ON-DEMAND)
// ==========================================
async function panggilSawerDetail() {
    const btn = document.getElementById("btnSawer");
    const originalContent = btn ? btn.innerHTML : "";
    
    // 1. Ambil ID & Nama Wayang
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const elNama = document.getElementById("displayName");
    const namaWayang = elNama ? elNama.innerText : "Karya Seni";

    if (!id) return showToast("ID Wayang tidak ditemukan.", 'error');

    if(btn) {
        btn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i>`;
        btn.disabled = true;
    }

    try {
        // 2. Ambil Owner Terbaru (Jaga-jaga jika baru terjual)
        const rpcProvider = new ethers.providers.JsonRpcProvider("https://mainnet.base.org");
        const readOnlyContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, rpcProvider);
        const ownerAddress = await readOnlyContract.ownerOf(id);

        // --- UPDATE PENTING DISINI ---
        // 3. Buat Pesan Otomatis (Supaya Owner Tahu Sumbernya)
        const autoMessage = `Saweran untuk: ${namaWayang} #${id}`;

        // 4. Kirim Pesan ke Modal
        await bukaModalSawer(ownerAddress, namaWayang, autoMessage);

    } catch (err) {
        console.error("Gagal ambil data:", err);
        showToast("Gagal memuat data pemilik.", 'error');
    } finally {
        if(btn) {
            btn.innerHTML = originalContent;
            btn.disabled = false;
        }
    }
  }


// ==========================================
// 2. LOGIKA BUKA MODAL & CEK SALDO
// ==========================================
// Tambahkan parameter 'autoMsg' agar bisa menerima pesan otomatis dari halaman detail
async function bukaModalSawer(address, name, autoMsg = "") {
    // 1. Pastikan userAddress terdeteksi
    let currentUser = typeof userAddress !== 'undefined' ? userAddress : null;
    
    if (!currentUser && window.ethereum) {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_accounts' });
            if (accounts.length > 0) currentUser = accounts[0];
        } catch(e) {}
    }

    if (!currentUser) {
        showToast("Harap hubungkan wallet (Connect) terlebih dahulu!", 'wolf');
        return;
    }

    // 2. Validasi alamat pemilik (Mencegah error 'Gagal memuat data pemilik')
    if (!address || address === "0x0000000000000000000000000000000000000000") {
        showToast("Data pemilik tidak valid.", 'error');
        return;
    }

    // Cek Self-Tipping
    if (currentUser.toLowerCase() === address.toLowerCase()) {
        showToast("Tidak bisa menyawer diri sendiri!", 'warning');
        return;
    }

    // Gunakan window agar terbaca oleh fungsi eksekusiSawer
    window.sawerTargetAddress = address;

    // 3. Update UI Modal dengan pengamanan (Optional Chaining)
    const elName = document.getElementById("sawerReceiverName");
    const elAddr = document.getElementById("sawerReceiverAddr");
    const elAmount = document.getElementById("sawerAmount");
    const elMsg = document.getElementById("sawerMessage");

    if(elName) elName.innerText = name;
    if(elAddr) elAddr.innerText = address.substring(0, 8) + "..." + address.substring(38);
    if(elAmount) elAmount.value = "";

    // PERBAIKAN: Ganti 'defaultMsg' yang tidak ada menjadi 'autoMsg'
    if(elMsg) {
        // Otomatis terisi pesan dari detail: "Saweran untuk: Arjuna #1"
        elMsg.value = autoMsg; 
        
        // Opsional: Set true agar user tidak bisa menghapus/mengubah pesan otomatis ini
        elMsg.readOnly = true; 
        
        // Tambahkan styling visual agar user tahu ini field otomatis
        elMsg.style.backgroundColor = "#f0f2f5"; 
    }

    // 4. Cek Saldo User
    try {
        const walletProvider = new ethers.providers.Web3Provider(window.ethereum);
        const balanceBN = await walletProvider.getBalance(currentUser);
        const ethVal = ethers.utils.formatEther(balanceBN);
        
        const elSaldo = document.getElementById("sawerUserBalance");
        if(elSaldo) {
            elSaldo.innerText = parseFloat(ethVal).toFixed(4) + " ETH";
            elSaldo.setAttribute('data-balance', ethVal);
        }
    } catch (e) {
        console.error("Gagal cek saldo:", e);
        if(document.getElementById("sawerUserBalance")) {
            document.getElementById("sawerUserBalance").innerText = "Err";
        }
    }

    // Tampilkan Modal
    toggleSawerModal(true);
}

// ==========================================
// 3. LOGIKA TOMBOL PERSENTASE (PERBAIKAN LOGIKA)
// ==========================================
function setSawerPercent(percent) {
    // 1. Pastikan Konstanta Terdefinisi (Hardcode jika perlu untuk keamanan)
    const LIMIT_MIN = 0.0001;
    const LIMIT_MAX = 0.005;
    const GAS_RESERVE = 0.0000055; // Cadangan gas fee lebih efisien 0.0003 ETH

    const elSaldo = document.getElementById("sawerUserBalance");
    const rawBalance = elSaldo ? elSaldo.getAttribute('data-balance') : null;
    
    if (!rawBalance || isNaN(parseFloat(rawBalance))) {
        showToast("Saldo belum terbaca, harap hubungkan wallet.", 'info');
        return;
    }

    let balanceEth = parseFloat(rawBalance);
    
    // 2. Hitung Saldo Aman (Saldo - Estimasi Gas)
    let maxSafeUser = balanceEth - GAS_RESERVE; 
    if (maxSafeUser < 0) maxSafeUser = 0;

    // 3. Tentukan Limit Efektif
    // Kita tidak boleh menyawer lebih dari LIMIT_MAX (0.005) 
    // dan tidak bisa lebih dari saldo aman user
    let effectiveLimit = Math.min(maxSafeUser, LIMIT_MAX); 

    let amount = 0;

    // 4. Logika Perhitungan Berdasarkan Tombol
    if (percent === 'MIN') {
        amount = LIMIT_MIN;
    } else {
        // Hitung persentase (25, 50, 75, 100) dari limit efektif
        amount = (effectiveLimit * percent) / 100;
    }

    // 5. Clamping (Validasi Batas Bawah dan Atas)
    // Jika hasil hitung di bawah MIN, bulatkan ke MIN selama saldo cukup
    if (amount < LIMIT_MIN && maxSafeUser >= LIMIT_MIN) {
        amount = LIMIT_MIN;
    }
    
    // Pastikan tidak melebihi saldo aman user
    if (amount > maxSafeUser) {
        amount = maxSafeUser;
    }

    // 6. Update Input Field
    const inputAmount = document.getElementById("sawerAmount");
    if (amount >= LIMIT_MIN) {
        // Menggunakan toFixed(6) untuk akurasi presisi ETH lalu parseFloat untuk hapus nol mubazir
        inputAmount.value = parseFloat(amount.toFixed(6)); 
    } else {
        inputAmount.value = "";
        showToast("Saldo Anda tidak cukup (Minimal + Gas Fee).", 'warning');
    }
}

// ==========================================
// 4. EKSEKUSI TRANSAKSI
// ==========================================
async function eksekusiSawer() {
    const amountVal = document.getElementById("sawerAmount").value;
    const msgVal = document.getElementById("sawerMessage").value;
    const btn = document.getElementById("btnKirimSawer");

    // --- PERBAIKAN KRITIS: Ambil target dari window atau global ---
    const target = window.sawerTargetAddress || sawerTargetAddress;

    if (!target || target === "0x0000000000000000000000000000000000000000") {
        showToast("Error: Alamat penerima tidak valid atau hilang.", 'error');
        return;
    }

    if (!amountVal || amountVal < MIN_TIP || amountVal > MAX_TIP) {
        showToast(`Nominal harus antara ${MIN_TIP} - ${MAX_TIP} ETH`, 'warning');
        return;
    }

    try {
        btn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> Memproses...`;
        btn.disabled = true;

        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        
        // Pastikan CONTRACT_ADDRESS dan CONTRACT_ABI sudah benar-benar terdefinisi di atas
        const contractWrite = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

        const amountWei = ethers.utils.parseEther(amountVal.toString());

        // EKSEKUSI: Pastikan urutan parameter sesuai ABI: _receiver (address), _message (string)
        const tx = await contractWrite.sendTip(target, msgVal, { 
            value: amountWei,
            // Opsional: Tambahkan gasLimit jika sering gagal di mobile
            gasLimit: 150000 
        });
        
        toggleSawerModal(false); 
        showToast("Transaksi dikirim ke Blockchain...", 'load');

        await tx.wait();
        
        showToast(`Berhasil mengirim ${amountVal} ETH!`, 'success');

        if (typeof userAddress !== 'undefined' && userAddress) {
            refreshUserBalance(userAddress); 
        }

    } catch (err) {
        console.error("Detail Error:", err);
        let msg = err.reason || err.message;
        
        // Handling error umum agar user tidak bingung
        if (msg.includes("invalid address")) msg = "Alamat tujuan salah atau tidak terbaca.";
        if (msg.includes("insufficient funds")) msg = "Saldo tidak cukup (termasuk Gas Fee).";
        if (err.code === 4001) msg = "Transaksi dibatalkan oleh pengguna.";
        
        showToast("Gagal: " + msg, 'error');
    } finally {
        btn.innerHTML = `<i class="fas fa-paper-plane"></i> Kirim Apresiasi`;
        btn.disabled = false;
    }
}


async function refreshUserBalance(address) {
    try {
        const walletProvider = new ethers.providers.Web3Provider(window.ethereum);
        const balanceBN = await walletProvider.getBalance(address);
        const ethVal = ethers.utils.formatEther(balanceBN);
        
        // Update elemen Saldo di Modal Sawer
        const elSaldoSawer = document.getElementById("sawerUserBalance");
        if(elSaldoSawer) {
            elSaldoSawer.innerText = parseFloat(ethVal).toFixed(4) + " ETH";
            elSaldoSawer.setAttribute('data-balance', ethVal);
        }

        // Jika Anda punya modal Wallet Info (modalBalance), update juga disana
        const elSaldoModal = document.getElementById("modalBalance");
        if(elSaldoModal) {
            elSaldoModal.innerText = parseFloat(ethVal).toFixed(4) + " ETH";
        }

        console.log("Saldo berhasil diupdate otomatis!");
    } catch (e) {
        console.error("Gagal refresh saldo:", e);
    }
}

// ==========================================
// 5. HELPER UI (BUKA/TUTUP)
// ==========================================
function toggleSawerModal(show = true) { // Default true jika dipanggil tanpa argumen
    const modal = document.getElementById("sawerModal");
    if (!modal) return;

    // Jika dipanggil dari tombol close (onclick="toggleSawerModal()")
    // Maka cek dulu apakah sedang terbuka atau tertutup
    if (arguments.length === 0) {
        show = !modal.classList.contains("active"); 
        // Tapi karena tombol close pasti ingin menutup, kita force false saja biar aman
        if (modal.style.display === "flex") show = false;
    }

    if (show) {
        modal.style.display = "flex";
        setTimeout(() => modal.classList.add("active"), 10);
    } else {
        modal.classList.remove("active");
        setTimeout(() => modal.style.display = "none", 300);
    }
}

function closeSawer(event) {
    if (event.target.id === "sawerModal") {
        toggleSawerModal(false);
    }
}

    // Fungsi untuk update angka di tombol Sawer
async function updateSawerCount(ownerAddress) {
    try {
        // Gunakan Provider Ringan (RPC Publik)
        const rpcProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const readContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, rpcProvider);

        // Panggil fungsi getTipCount dari Smart Contract
        const countBN = await readContract.getTipCount(ownerAddress);
        
        // Update tampilan tombol
        const el = document.getElementById("sawerCount");
        if(el) {
            el.innerText = countBN.toString();
        }

    } catch (e) {
        console.warn("Gagal load sawer count:", e);
    }
}

    /* BARU V3.2 */
    async function loadRelatedWayang(currentId, golongan, currentGaya) {
    const PINATA_GW = "https://magenta-secondary-guan-686.mypinata.cloud/ipfs/";
    const safePlaceholder = "data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20200%20300%22%3E%3C/svg%3E";

    // Fungsi pembersih URL
    const getPureCid = (url) => {
        if(!url) return "";
        return url.replace("ipfs://", "")
                  .replace("https://ipfs.io/ipfs/", "")
                  .replace("https://cloudflare-ipfs.com/ipfs/", "")
                  .replace("https://gateway.pinata.cloud/ipfs/", "")
                  .replace(PINATA_GW, "");
    };

    // --- 1. LOGIKA PENEMPATAN: TARGETKAN KOLOM KIRI ---
    // Kita cari '.left-col' agar rekomendasi muncul di bawah foto wayang
    const leftColumn = document.querySelector('.left-col');
    
    if (!leftColumn) return; // Jika tidak ada kolom kiri, stop.

    // Cek agar tidak render dobel
    if (document.getElementById('relatedSection')) return;

    // Buat Wadah HTML
    const section = document.createElement('div');
    section.id = 'relatedSection';
    section.className = 'related-section';
    section.innerHTML = `
        <div class="related-title">
            <i class="fas fa-project-diagram"></i> Kerabat & ${golongan}
        </div>
        <div id="relatedGrid" class="related-grid"></div>
    `;

    // MASUKKAN KE KOLOM KIRI (Paling Bawah)
    leftColumn.appendChild(section);

    try {
        const rpcProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, rpcProvider);

        const ids = await contract.getIdsByGolongan(golongan);
        
        // Ambil maksimal 5 agar pas di kolom kiri
        let candidates = ids.filter(id => id.toString() !== currentId.toString())
                            .sort(() => 0.5 - Math.random())
                            .slice(0, 5);

        const grid = document.getElementById('relatedGrid');
        
        // Render Rangka (HTML Structure yang cocok untuk Flex Row di PC)
        grid.innerHTML = candidates.map(id => `
            <a href="detail?id=${id}" class="mini-rel-card" id="rel-card-${id}">
                <div class="img-container">
                    <img src="${safePlaceholder}" id="rel-img-${id}" class="mini-rel-img" alt="Wayang">
                </div>
                <div class="mini-rel-info" id="rel-info-${id}">
                    <div style="height:10px; width:70%; background:#eee; margin-bottom:5px; border-radius:4px;"></div>
                    <div style="height:8px; width:40%; background:#eee; border-radius:2px;"></div>
                </div>
            </a>
        `).join("");

        // Load Data
        candidates.forEach(async (id) => {
            try {
                const info = await contract.getInfoWayang(id);
                const uri = await contract.tokenURI(id);
                
                // Update Teks
                const infoEl = document.getElementById(`rel-info-${id}`);
                if(infoEl) {
                    infoEl.innerHTML = `
                        <span class="mini-rel-name" title="${info.nama}">${info.nama}</span>
                        <div class="meta-row">
                            <span class="badge-gaya">${info.gaya}</span>
                        </div>
                    `;
                }

                // Update Gambar
                const metaCid = getPureCid(uri);
                const res = await fetch(`${PINATA_GW}${metaCid}`);
                const meta = await res.json();
                const rawImg = meta.image || meta.image_url;

                if (rawImg) {
                    const imgCid = getPureCid(rawImg);
                    const finalUrl = `${PINATA_GW}${imgCid}`;
                    const optimizedUrl = `https://wsrv.nl/?url=${encodeURIComponent(finalUrl)}&w=150&h=150&fit=contain&output=webp`;

                    const imgEl = document.getElementById(`rel-img-${id}`);
                    if (imgEl) {
                        imgEl.src = optimizedUrl;
                        imgEl.onload = () => { imgEl.style.opacity = "1"; };
                        imgEl.onerror = function() {
                            this.onerror = null;
                            this.src = finalUrl;
                            this.style.opacity = "1";
                        };
                    }
                }
            } catch (err) { console.warn("Skip item", id); }
        });

    } catch (e) { console.error("Rekomendasi Error", e); }
    }
    
    function showToast(msg, type = 'info') {
    const x = document.getElementById("toast");

    const icons = {
        info: 'img/info-icon.svg',
        load: 'img/load.svg',
        loading: 'img/loading.svg',
        success: 'img/success.svg',
        error: 'img/error.svg',
        warning: 'img/warning.svg',
        wolf: 'img/wolf.svg'
    };

    const closeIcon = 'img/x.svg'; 

    if (!icons[type]) type = 'info';

    x.innerHTML = `
        <img src="${icons[type]}" class="toast-icon" alt="${type}"> 
        <span style="flex:1;">${msg}</span>
        <img src="${closeIcon}" class="toast-close" onclick="this.parentElement.className = this.parentElement.className.replace('show', '')" alt="close">
    `;

    x.className = ''; 
    void x.offsetWidth; 
    x.className = `show ${type}`;

    if (toastTimeout) clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => { 
        x.className = x.className.replace("show", ""); 
    }, 10000); 
    }

    init();
document.getElementById("year").innerText = new Date().getFullYear();
</script>
</script>
</body>
  </html>
