<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Arsip Wayang</title>
    <meta name="description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official">
    <meta name="keywords" content="
Wayang,
Wayang Kulit,
Wayang Kulit Indonesia,
Wayang Indonesia,
Wayang Nusantara,

Wayang Kulit Gagrak Cirebon,
Wayang Gagrak Cirebon,
Wayang Cirebon,
Wayang Kulit Cirebon,

Wayang Kulit Jawa,
Wayang Kulit Jawa Tengah,
Wayang Kulit Jawa Timur,
Wayang Kulit Jawa Barat,

Wayang Kulit Gagrak Yogyakarta,
Wayang Kulit Gagrak Surakarta,
Wayang Kulit Gagrak Solo,
Wayang Kulit Gagrak Banyumas,
Wayang Kulit Gagrak Kedu,
Wayang Kulit Gagrak Mataram,

Wayang Kulit Purwa,
Wayang Kulit Parwa,
Wayang Kulit Bali,
Wayang Bali,

Wayang Kulit Sasak,
Wayang Sasak Lombok,

Wayang Kulit Madura,
Wayang Madura,

Wayang Kulit Banjar,
Wayang Banjar Kalimantan,

Wayang Kulit Betawi,
Wayang Betawi,

Wayang Kulit Sunda,
Wayang Golek,
Wayang Golek Sunda,
        
Wayang Kulit Pesisiran,
Wayang Kulit Pantura,
        
Wayang Ramayana,
Wayang Mahabharata,
Tokoh Wayang,
Arsip Wayang,
Galeri Wayang,
Koleksi Wayang Kulit
">
    <meta name="robots" content="index, follow">

    <link rel="canonical" href="https://putramas.web.id">

    <meta property="og:title" content="Putramas Official | Digital Galeri Wayang Nusantara>
    <meta property="og:description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official.">
    <meta property="og:url" content="https://putramas.web.id">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://putramas.web.id/img/og.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Putramas Official | Digital Galeri Wayang Nusantara">
    <meta name="twitter:description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official.">
    <meta name="twitter:image" content="https://putramas.web.id/img/og.png">
    
    <link rel="icon" href="/img/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/img/icon-512.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        :root {
            --primary: #8b5a2b;
            --dark: #1a1510;
            --light: #e0d8c3;
            --accent: #deb887;
        }

        * { box-sizing: border-box; }
        body { 
            font-family: 'Rubik', sans-serif; 
            background-color: #ffffff; 
            color: #5c6a84; 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            background: #f6f9ff;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .nav-left { display: flex; align-items: center; gap: 15px; }
        
        .nav-logo {
            width: 45px; height: 45px;
            border-radius: 50%;
            border: 2px solid #7385a5;
            object-fit: cover;
        }
        
        #btn-connect {
            background: transparent; color: #7385a5; border: 2px solid #7385a5; 
            padding: 10px 25px; cursor: pointer; font-family: 'Rubik', sans-serif; 
            font-weight: bold; border-radius: 30px; transition: 0.3s; font-size: 12px;
        }
        #btn-connect:hover { background: #f6f9ff; color: #7385a5; border: 2px solid #7385a5; }
        #btn-connect.connected { background: #abb6c9; color: #fff; border-color: #7385a5; cursor: default; }
        
        .container { max-width: 1100px; margin: 40px auto; display: flex; flex-wrap: wrap; gap: 40px; padding: 20px; }
        
        .left-col { flex: 1; min-width: 300px; }
        .img-frame { 
            background: #fdfbf7; border: 10px solid #666666; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); border-radius: 5px; 
            overflow: hidden; position: relative; 
        }
        .img-frame img { width: 100%; height: auto; display: block; }
        .id-badge { 
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); 
            color: white; padding: 5px 10px; font-size: 12px; border-radius: 4px; 
        }

        .right-col { flex: 1.5; min-width: 300px; }
        h1, h2, h3  { margin: 0 0 10px 0; color: #7385a5; border-bottom: 2px solid #b3b3b3; display: inline-block; padding-bottom: 10px; }
        .gaya-tag { background: #7385a5; color: white; padding: 5px 15px; border-radius: 20px; border: 2px solid #5c6a84; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; vertical-align: middle; margin-left: 15px; }
        .description { font-size: 1em; line-height: 1.8; color: #666666; margin-bottom: 30px; text-align: justify; }

        .meta-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .meta-box { background: #e9f0ff; padding: 15px; border-radius: 8px; border: 2px solid #7385a5; }
        .meta-label { font-size: 12px; text-transform: uppercase; color: #666; letter-spacing: 1px; display: block; margin-bottom: 5px; }
        .meta-value { font-size: 16px; font-weight: bold; color: #5c6a84; }

        .silsilah-box { background: #e9f0ff; padding: 20px; border: 1px solid #7385a5; border-radius: 8px; }
        .silsilah-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #666; padding: 10px 0; }
        
        .social-section { margin-top: 40px; border-top: 1px dashed #5d4037; padding-top: 20px; }
        .review-box { background: #e9f0ff; padding: 20px; border-radius: 10px; border: 1px solid #7385a5; margin-bottom: 20px; }
        
        .star-rating span { font-size: 30px; cursor: pointer; color: #444; transition: 0.2s; }
        .star-rating span:hover, .star-rating span.active { color: gold; }
        
        .chip { background: #e9f0ff; color: #666; border: 1px solid #7385a5; padding: 8px 15px; border-radius: 20px; cursor: pointer; transition: 0.2s; margin-bottom: 5px; font-weight: bold; }
        .chip:hover, .chip.selected { background: #7385a5; color: #fff; font-weight: bold; }
        .review-card { background: #e9f0ff; padding: 15px; border-radius: 5px; border: 1px solid #7385a5; margin-bottom: 10px; }

        .footer {
            background: #f6f9ff;
            padding: 20px 20px;
            margin-top: 25px;
            text-align: center;
            width: 100%; /* WAJIB FULL */
        }

        .social-icons { margin-bottom: 10px; }
        
        .social-link {
            display: inline-flex; justify-content: center; align-items: center;
            width: 35px; height: 35px; margin: 0 07px;
            border-radius: 50%; background: #7385a5; color: #fff;
            font-size: 15px; transition: all 0.3s ease; border: 1.5px solid #7385a5;
            text-decoration: none;
        }
        .social-link:hover {
            background: #fff; color: #7385a5;
            transform: translateY(-5px); box-shadow: 0 0 15px #7385a5;
        }

        .copyright { color: #888; font-size: 13px; letter-spacing: 1px; margin-top: 10px; }

    #toast {
    visibility: hidden;
    min-width: 220px;
    max-width: 85%;
    position: fixed;
    z-index: 99999;
    top: 90px;
    right: 20px;
    left: auto;
    background-color: rgba(51, 51, 51, 0.95);
    backdrop-filter: blur(8px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.15);
    color: #fff;
    padding: 10px 35px 10px 15px; 
    display: flex;
    align-items: center;
    font-family: 'Rubik', sans-serif;
    font-weight: 500;
    font-size: 11px;
    letter-spacing: 0.3px;
    opacity: 0;
    transform: translateX(20px) scale(0.9); 
    transition: all 0.4s cubic-bezier(0.2, 0, 0, 1), visibility 0s 0.4s; 
}

#toast.show {
    visibility: visible;
    opacity: 1;
    transform: translateX(0) scale(1);
    transition: all 0.4s cubic-bezier(0.2, 0, 0, 1), visibility 0s 0s;
}
    
#toast .toast-icon {
    width: 23px;
    height: 23px; 
    margin-right: 10px; 
    object-fit: contain;
}

#toast .toast-close {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 9px;
    height: 9px;
    cursor: pointer;
    opacity: 0.6;
    transition: 0.2s;
}

        #toast .toast-close:hover { opacity: 1; transform: scale(1.1); }

    #toast.info {
    background: rgba(0, 53, 107, 0.35);
    border: 1px solid rgba(0, 100, 204, 0.4);
    color: #fff;
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.35), 0 0 20px rgba(0, 100, 255, 0.25);
}

#toast.success {
    background: rgba(0, 77, 7, 0.35);
    color: #fff;
    border: 1px solid rgba(0, 184, 15, 0.4);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.35), 0 0 20px rgba(0,255,0,0.2);
}

#toast.error {
    background: rgba(107, 0, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(184, 0, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.40), 0 0 22px rgba(255,0,0,0.25);
    }

#toast.warning {
    background: rgba(102, 98, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(179, 171, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.40), 0 0 20px rgba(255,255,0,0.25);
}

#toast.wolf {
    background: rgba(125, 65, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(204, 106, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(255,140,0,0.25);
}

#toast.load {
    background: rgba(49, 77, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(104, 163, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(0,255,0,0.25);
}
    
#toast.loading {
    background: rgba(52, 90, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(94, 163, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(94, 163, 0, 0.25);
}

@keyframes slideDown {
    from {top: -50px; opacity: 0;}
    to {top: 30px; opacity: 1;}
}

@keyframes fadeOut {
    from {top: 30px; opacity: 1;}
    to {top: -50px; opacity: 0;}
        }
    </style>
</head>
<body>

<nav class="navbar">
        <div class="nav-left">
  <a href="index" style="display: flex; align-items: center; text-decoration: none;">
    <img src="img/icon-192.png" class="nav-logo" style="margin-right:8px;">
    <span class="nav-brand" style="font-size:17px; color: #7385a5; font-weight:bold;">Putramas Official</span>
  </a>
        </div>
        <div class="nav-right">
            <button id="btn-connect" onclick="connectWallet()">
    <img src="img/chain.svg" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 8px; margin-bottom: 2px;">
    Hubungkan
            </button>
        </div>
</nav>

<div id="loading" style="text-align: center; margin-top: 100px; font-size: 13px; color: #80db80;">
    <img src="img/loading.svg" style="width: 17px; height: 17px; vertical-align: middle;"> Membuka Detail Arsip...
</div>

<div id="content" class="container" style="display: none;">
    <div class="left-col">
        <div class="img-frame">
            <div class="id-badge">ID: #<span id="displayId">0</span></div>
            <img id="displayImg" src="" alt="Wayang">
        </div>
        <div style="text-align: center; margin-top: 20px; color: #666; font-size: 12px;">
            Permanen di Base Mainnet
        </div>
    </div>

    <div class="right-col">
        <div>
            <h2 id="displayName">Nama Tokoh</h2>
            <span id="displayGaya" class="gaya-tag">Gaya</span>
        </div>
        
        <p class="description" id="displayDesc">Deskripsi...</p>

        <h3 style="color:#7385a5; border-bottom:1px solid #444; padding-bottom:5px;">Data Fisik & Budaya</h3>
        <div class="meta-grid">
            <div class="meta-box"><span class="meta-label">Golongan</span><span class="meta-value" id="displayGolongan">-</span></div>
            <div class="meta-box"><span class="meta-label">Wanda</span><span class="meta-value" id="displayWanda">-</span></div>
            <div class="meta-box"><span class="meta-label">Material</span><span class="meta-value" id="displayKulit">-</span></div>
            <div class="meta-box"><span class="meta-label">Pembuat</span><span class="meta-value" id="displayPembuat">-</span></div>
        </div>

        <h3 style="color:#7385a5; border-bottom:1px solid #444; padding-bottom:5px;">Silsilah & Asal Usul</h3>
        <div class="silsilah-box">
            <div class="silsilah-row"><span style="color:#666">Negara:</span><span style="font-weight:bold" id="displayNegara">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Ayah:</span><span style="font-weight:bold" id="displayAyah">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Ibu:</span><span style="font-weight:bold" id="displayIbu">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Pusaka:</span><span style="font-weight:bold" id="displayPusaka">-</span></div>
        </div>

        <div class="social-section">
            
            <div style="margin-bottom: 25px;">

    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
        
        <button onclick="kirimLike()" id="btnLike" style="background: none; border: 2px solid #7385a5; color: #7385a5; padding: 10px 20px; border-radius: 30px; cursor: pointer; font-size: 15px; display: flex; align-items: center; gap: 10px; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
            <img src="img/lv.svg" style="width: 16px; height: 16px; vertical-align: middle;"> 
            <span id="likeCount">0</span> Suka
        </button>

        <button onclick="smartShare()" id="btnShare" style="background: none; color: #7385a5; border: 2px solid #7385a5; padding: 10px 20px; border-radius: 30px; cursor: pointer; font-size: 15px; display: flex; align-items: center; gap: 10px; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
            <img src="img/shr.svg" style="width: 16px; height: 16px; vertical-align: middle;">
            Bagikan
        </button>
    </div>
    <br>
    <center><div style="margin-top: 8px; margin-left: 5px; color: #666; font-size: 12px; font-style: italic;">
        (Klik Suka & Ulasan untuk mendukung pelestarian)
    </div></center>

            </div>

            <div class="review-box">
                <h3 style="color: #7385a5; margin-top: 0;">Beri Rating</h3>
                
                <div class="star-rating" style="margin-bottom: 15px;">
                    <span onclick="pilihBintang(1)">★</span>
                    <span onclick="pilihBintang(2)">★</span>
                    <span onclick="pilihBintang(3)">★</span>
                    <span onclick="pilihBintang(4)">★</span>
                    <span onclick="pilihBintang(5)">★</span>
                </div>
                <input type="hidden" id="selectedStar" value="0">

                <div style="margin-bottom: 15px;">
                    <p style="color:#7385a5; font-size:12px; margin-bottom:5px;">Pilih Ulasan:</p>
                    <div id="pilihanUlasan" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="chip" onclick="pilihTag(this, 'Luar Biasa')">Luar Biasa</button>
                        <button class="chip" onclick="pilihTag(this, 'Sangat Detail')">Sangat Detail</button>
                        <button class="chip" onclick="pilihTag(this, 'Estetik')">Estetik</button>
                        <button class="chip" onclick="pilihTag(this, 'Super')">Super</button>
                        <button class="chip" onclick="pilihTag(this, 'Masterpiece')">Masterpiece</button>
                        <button class="chip" onclick="pilihTag(this, 'Bersejarah')">Bersejarah</button>
                    </div>
                    <input type="hidden" id="selectedTag" value="">
                </div>

                <button onclick="kirimUlasan()" style="background: #7385a5; color: white; border: 2px solid #5c6a84; padding: 12px 25px; border-radius: 10px; cursor: pointer; width: 50%; font-weight: bold; display: block; margin: 0 auto;">
                    Kirim Ulasan
                </button>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="color: #7385a5;">Ulasan Pengunjung (<span id="reviewCount">0</span>)</h3>
                <div id="reviewContainer">
                    <p style="color:#80db80; font-style: italic; font-size: 13px;">Memuat ulasan...</p>
                </div>
            </div>
        </div>

    </div>
</div>

<div id="toast"></div>

<footer class="footer">
        <div class="footer-content">
            <div class="social-icons">
                <a href="https://youtube.com/@PutramasOfficial" target="_blank" class="social-link"><i class="fab fa-youtube"></i></a>
                <a href="https://instagram.com/putramas_official" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                <a href="https://facebook.com/PutramasOfficial" target="_blank" class="social-link"><i class="fab fa-facebook-f"></i></a>
                <a href="https://facebook.com/PutramasOfficialStudio" target="_blank" class="social-link"><i class="fab fa-facebook-f"></i></a>
            </div>
            <p class="copyright">
                &copy; <span id="year"></span> Powered By <strong>Putramas Official</strong>
            </p>
        </div>
</footer>

<script>
    const CONTRACT_ADDRESS = "0x5dfe8311e98b0443C471A10e26198b72355Ca713"; // <--- Paste Contract Address Disini
    
    const BASE_SEPOLIA_ID = '0x14a34'; // 84532
    const BASE_SEPOLIA_RPC = 'https://sepolia.base.org';
    const BASE_SEPOLIA_CONFIG = {
        chainId: BASE_SEPOLIA_ID,
        chainName: 'Base Sepolia Testnet',
        nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
        rpcUrls: [BASE_SEPOLIA_RPC],
        blockExplorerUrls: ['https://sepolia.basescan.org']
    };

    const CONTRACT_ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"}],"name":"Liked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"star","type":"uint8"},{"indexed":false,"internalType":"string","name":"ulasan","type":"string"}],"name":"Reviewed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"nama","type":"string"},{"indexed":false,"internalType":"string","name":"golongan","type":"string"}],"name":"WayangLahir","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"namaBaru","type":"string"},{"indexed":false,"internalType":"string","name":"uriBaru","type":"string"}],"name":"WayangUpdate","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_penerima","type":"address"},{"internalType":"string","name":"_tokenURI","type":"string"},{"internalType":"string","name":"_nama","type":"string"},{"internalType":"string","name":"_golongan","type":"string"},{"internalType":"string","name":"_gaya","type":"string"}],"name":"arsipWayang","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"dalang","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getAverageRating","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"golongan","type":"string"}],"name":"getIdsByGolongan","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getInfoWayang","outputs":[{"components":[{"internalType":"string","name":"nama","type":"string"},{"internalType":"string","name":"golongan","type":"string"},{"internalType":"string","name":"gaya","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"}],"internalType":"struct WayangArsipPro.WayangInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getReviews","outputs":[{"components":[{"internalType":"address","name":"reviewer","type":"address"},{"internalType":"uint8","name":"bintang","type":"uint8"},{"internalType":"string","name":"ulasan","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct WayangArsipPro.Review[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"hasLiked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"hasReviewed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"kasihLike","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"_bintang","type":"uint8"},{"internalType":"string","name":"_ulasanPilihan","type":"string"}],"name":"kasihUlasan","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"string","name":"_namaBaru","type":"string"},{"internalType":"string","name":"_uriBaru","type":"string"}],"name":"revisiDataWayang","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"totalLikes","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"walletOfOwner","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"wayangRegistry","outputs":[{"internalType":"string","name":"nama","type":"string"},{"internalType":"string","name":"golongan","type":"string"},{"internalType":"string","name":"gaya","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"wayangReviews","outputs":[{"internalType":"address","name":"reviewer","type":"address"},{"internalType":"uint8","name":"bintang","type":"uint8"},{"internalType":"string","name":"ulasan","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"}];

    let provider;
    let signer;
    let toastTimeout;

    async function init() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (!id) {
            document.getElementById("loading").innerText = "Gagal: ID Arsip tidak ditemukan.";
            return;
        }

        if(window.ethereum && window.ethereum.selectedAddress) {
             connectWallet();
        }

        await loadDetail(id);
        await loadSocialData(id);
    }

    async function connectWallet() {
        if (!window.ethereum) return showToast("Install Metamask Atau EVM Wallet Dulu!", 'wolf');

        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            
            const network = await provider.getNetwork();
            if (network.chainId !== 84532) {
                await switchNetwork();
            }

            signer = provider.getSigner();
            const address = await signer.getAddress();
            
            const btn = document.getElementById("btn-connect");
            btn.innerText = address.substring(0,6) + "...";
            btn.classList.add("connected");

        } catch (err) {
            console.error(err);
            showToast("Gagal koneksi: " + err.message, 'error');
        }
    }

    async function switchNetwork() {
        try {
            await window.ethereum.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: BASE_SEPOLIA_ID }],
            });
        } catch (switchError) {
            if (switchError.code === 4902) {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [BASE_SEPOLIA_CONFIG],
                });
            } else {
                throw switchError;
            }
        }
    }

    async function loadDetail() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (!id) {
            document.getElementById("loading").innerText = "ID Arsip tidak ditemukan.";
            return;
        }

        try {
            const provider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);
            const uri = await contract.tokenURI(id);
            const httpUri = uri.replace("ipfs://", "https://gateway.pinata.cloud/ipfs/");
            const response = await axios.get(httpUri);
            const meta = response.data;
            const rawImgUrl = meta.image.replace("ipfs://", "https://gateway.pinata.cloud/ipfs/");
            const hdImageUrl = `https://wsrv.nl/?url=${encodeURIComponent(rawImgUrl)}&w=1200&q=95&output=webp`;
            const getAttr = (k) => {
                const f = meta.attributes.find(a => a.trait_type === k);
                return f ? f.value : "-";
            };

            document.getElementById("displayId").innerText = id;
            
            const imgEl = document.getElementById("displayImg");
            imgEl.src = hdImageUrl;
            imgEl.style.opacity = 0;
            imgEl.onload = () => { imgEl.style.opacity = 1; imgEl.style.transition = "opacity 0.5s"; };

            document.getElementById("displayName").innerText = meta.name;
            document.getElementById("displayGaya").innerText = getAttr("Gaya");
            document.getElementById("displayDesc").innerText = meta.description;
            
            document.getElementById("displayGolongan").innerText = getAttr("Golongan");
            document.getElementById("displayWanda").innerText = getAttr("Wanda");
            document.getElementById("displayKulit").innerText = getAttr("Material Kulit");
            document.getElementById("displayPembuat").innerText = getAttr("Pembuat");
            
            document.getElementById("displayNegara").innerText = getAttr("Negara");
            document.getElementById("displayAyah").innerText = getAttr("Ayah");
            document.getElementById("displayIbu").innerText = getAttr("Ibu");
            document.getElementById("displayPusaka").innerText = getAttr("Pusaka") || "-";

            document.getElementById("loading").style.display = "none";
            document.getElementById("content").style.display = "flex";

        } catch (err) {
            console.error(err);
            document.getElementById("loading").innerText = "Gagal memuat data wayang. Cek koneksi.";
        }
    }

    async function loadSocialData(id) {
        try {
            const readProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, readProvider);
            const likes = await contract.totalLikes(id);
            document.getElementById("likeCount").innerText = likes.toString();
            const reviews = await contract.getReviews(id);
try {
    const avgScore = await contract.getAverageRating(id);
    const finalScore = (avgScore / 10).toFixed(1);
    if(avgScore > 0) {
        document.getElementById("displayName").innerHTML += 
            ` <span style="font-size:16px; color:gold; border:1px solid gold; padding:2px 8px; border-radius:10px;">⭐ ${finalScore}</span>`;
    }
} catch (e) {
    console.log("Belum ada rating rata-rata");
}
            document.getElementById("reviewCount").innerText = reviews.length;
            
            const container = document.getElementById("reviewContainer");
            
            if(reviews.length === 0) {
                container.innerHTML = `<p style="color:#666; font-style: italic;">Belum ada ulasan.</p>`;
            } else {
                container.innerHTML = "";
                [...reviews].reverse().forEach(r => {
                    const bintangStr = "★".repeat(r.bintang);
                    const html = `
                        <div class="review-card">
                            <div style="font-size: 11px; color: #5c6a84; margin-bottom:5px;">
                                ${r.reviewer.substring(0,6)}...${r.reviewer.substring(38)}
                            </div>
                            <div style="color: gold; font-size: 16px;">${bintangStr}</div>
                            <div style="color: #666; margin-top: 5px; font-style: italic;">"${r.ulasan}"</div>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            }

        } catch (err) {
            console.error("Gagal load social:", err);
        }
    }

    async function ensureWallet() {
        if(!signer) {
            await connectWallet();
            if(!signer) throw new Error("Wallet belum terkoneksi");
        }
    }

    async function kirimLike() {
        try {
            await ensureWallet();
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
            
            const btn = document.getElementById("btnLike");
            const oriText = btn.innerHTML;
            btn.innerHTML = `
    <img src="img/loading.svg" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> 
    Send...
`;
            const tx = await contract.kasihLike(id);
            await tx.wait();
            
            showToast("Berhasil Like!", 'success');
            location.reload();

        } catch(err) {
            showToast("Gagal: " + (err.reason || err.message), 'error');
            document.getElementById("btnLike").innerHTML = '<img src="img/lv.svg" style="width: 16px; height: 16px; vertical-align: middle;"> Like';
        }
    }

    async function kirimUlasan() {
        try {
            const bintang = document.getElementById("selectedStar").value;
            const tag = document.getElementById("selectedTag").value;
            if(bintang == 0 || tag == "") return showToast("Pilih bintang & kata ulasan dulu!", 'warning');

            await ensureWallet();
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
            
            const tx = await contract.kasihUlasan(id, bintang, tag);
            showToast("Transaksi review dikirim. Tunggu konfirmasi...", 'loading');
            await tx.wait();
            
            showToast("Review Berhasil!", 'success');
            location.reload();

        } catch(err) {
            showToast("Gagal: " + (err.reason || err.message), 'error');
        }
    }

    function pilihBintang(n) {
        document.getElementById("selectedStar").value = n;
        const stars = document.querySelectorAll('.star-rating span');
        stars.forEach((s, index) => {
            if(index < n) s.classList.add('active');
            else s.classList.remove('active');
        });
    }

    function pilihTag(btn, teks) {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
        btn.classList.add('selected');
        document.getElementById("selectedTag").value = teks;
    }

    async function smartShare() {
    const shareData = {
        title: document.title,
        text: 'Lihat koleksi Wayang Nusantara ini! Sangat detail dan estetik.',
        url: window.location.href
    };

    const btnShare = document.getElementById("btnShare");
    const originalText = btnShare.innerHTML;

    if (navigator.share) {
        try {
            await navigator.share(shareData);
            console.log('Berhasil dibagikan');
        } catch (err) {
            console.log('Batal membagikan');
        }
    } else {
        try {
            await navigator.clipboard.writeText(window.location.href);
            btnShare.innerHTML = `<img src="img/success.svg" style="width: 19px; height: 19px; vertical-align: middle;"> Link Disalin!`;
            setTimeout(() => {
                btnShare.innerHTML = originalText;
            }, 2000);
        } catch (err) {
            showToast("Gagal menyalin link: " + err, 'error');
        }
    }
    }

    function showToast(msg, type = 'info') {
    const x = document.getElementById("toast");

    const icons = {
        info: 'img/info-icon.svg',
        load: 'img/load.svg',
        loading: 'img/loading.svg',
        success: 'img/success.svg',
        error: 'img/error.svg',
        warning: 'img/warning.svg',
        wolf: 'img/wolf.svg'
    };

    const closeIcon = 'img/x.svg'; 

    if (!icons[type]) type = 'info';

    x.innerHTML = `
        <img src="${icons[type]}" class="toast-icon" alt="${type}"> 
        <span style="flex:1;">${msg}</span>
        <img src="${closeIcon}" class="toast-close" onclick="this.parentElement.className = this.parentElement.className.replace('show', '')" alt="close">
    `;

    x.className = ''; 
    void x.offsetWidth; 
    x.className = `show ${type}`;

    if (toastTimeout) clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => { 
        x.className = x.className.replace("show", ""); 
    }, 10000); 
    }

    init();
document.getElementById("year").innerText = new Date().getFullYear();
</script>
</script>
</body>
</html>
