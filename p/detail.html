<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Arsip Wayang</title>
    <meta name="description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official">
    <meta name="keywords" content="
Wayang,
Wayang Kulit,
Wayang Kulit Indonesia,
Wayang Indonesia,
Wayang Nusantara,

Wayang Kulit Gagrak Cirebon,
Wayang Gagrak Cirebon,
Wayang Cirebon,
Wayang Kulit Cirebon,

Wayang Kulit Jawa,
Wayang Kulit Jawa Tengah,
Wayang Kulit Jawa Timur,
Wayang Kulit Jawa Barat,

Wayang Kulit Gagrak Yogyakarta,
Wayang Kulit Gagrak Surakarta,
Wayang Kulit Gagrak Solo,
Wayang Kulit Gagrak Banyumas,
Wayang Kulit Gagrak Kedu,
Wayang Kulit Gagrak Mataram,

Wayang Kulit Purwa,
Wayang Kulit Parwa,
Wayang Kulit Bali,
Wayang Bali,

Wayang Kulit Sasak,
Wayang Sasak Lombok,

Wayang Kulit Madura,
Wayang Madura,

Wayang Kulit Banjar,
Wayang Banjar Kalimantan,

Wayang Kulit Betawi,
Wayang Betawi,

Wayang Kulit Sunda,
Wayang Golek,
Wayang Golek Sunda,
        
Wayang Kulit Pesisiran,
Wayang Kulit Pantura,
        
Wayang Ramayana,
Wayang Mahabharata,
Tokoh Wayang,
Arsip Wayang,
Galeri Wayang,
Koleksi Wayang Kulit
">
    <meta name="robots" content="index, follow">

    <link rel="canonical" href="https://putramas.web.id">

    <meta property="og:title" content="Putramas Official | Digital Galeri Wayang Nusantara>
    <meta property="og:description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official.">
    <meta property="og:url" content="https://putramas.web.id">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://putramas.web.id/img/og.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Putramas Official | Digital Galeri Wayang Nusantara">
    <meta name="twitter:description" content="Kunjungi Koleksi Wayang Kulit Nusantara Di Galeri Digital Putramas Official.">
    <meta name="twitter:image" content="https://putramas.web.id/img/og.png">
    
    <link rel="icon" href="/img/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/img/icon-512.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        :root {
            --primary: #8b5a2b;
            --dark: #1a1510;
            --light: #e0d8c3;
            --accent: #deb887;
        }

        * { box-sizing: border-box; }
        body { 
            font-family: 'Rubik', sans-serif; 
            background-color: #ffffff; 
            color: #5c6a84; 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            background: #f6f9ff;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .nav-left { display: flex; align-items: center; gap: 15px; }
        
        .nav-logo {
            width: 45px; height: 45px;
            border-radius: 50%;
            border: 2px solid #7385a5;
            object-fit: cover;
        }
        
        #btn-connect {
            background: transparent; color: #7385a5; border: 2px solid #7385a5; 
            padding: 10px 25px; cursor: pointer; font-family: 'Rubik', sans-serif; 
            font-weight: bold; border-radius: 30px; transition: 0.3s; font-size: 14px;
        }
        #btn-connect:hover { background: #f6f9ff; color: #7385a5; border: 2px solid #7385a5; }
        #btn-connect.connected { background: #abb6c9; color: #fff; border-color: #7385a5; cursor: default; }

        @media (max-width: 600px) {
            .navbar { padding: 15px 20px; }
            .nav-brand { font-size: 0.9em; }
            #btn-connect { padding: 8px 15px; font-size: 12px; }
            h1 { font-size: 2em; }
        }
        
        .container { max-width: 1100px; margin: 40px auto; display: flex; flex-wrap: wrap; gap: 40px; padding: 20px; }
        
        .left-col { flex: 1; min-width: 300px; }
        .img-frame { 
            background: #fdfbf7; border: 10px solid #666666; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); border-radius: 5px; 
            overflow: hidden; position: relative; 
        }
        .img-frame img { width: 100%; height: auto; display: block; }
        .id-badge { 
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); 
            color: white; padding: 5px 10px; font-size: 12px; border-radius: 4px; 
        }

        .right-col { flex: 1.5; min-width: 300px; }
        h1, h2, h3  { margin: 0 0 10px 0; color: #7385a5; border-bottom: 2px solid #b3b3b3; display: inline-block; padding-bottom: 10px; }
        .gaya-tag { background: #7385a5; color: white; padding: 4px 12px; border-radius: 20px; border: 2px solid #5c6a84; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; vertical-align: middle; margin-left: 15px; }
        .description { font-size: 1em; line-height: 1.8; color: #666666; margin-bottom: 30px; text-align: justify; }

        /* --- 1. STYLE GLOBAL (HP & PC) --- */
.meta-grid { 
    display: grid;
    /* PENTING: minmax(140px, 1fr) artinya lebar kotak minimal 140px. 
       Di HP standar (360px) ini akan otomatis jadi 2 KOLOM yang pas. 
       Tidak akan maksa 3 kolom lagi. */
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px; 
    margin-bottom: 30px; 
}

.meta-box { 
    background: #e9f0ff; 
    padding: 12px 15px; /* Padding sedang */
    border-radius: 15px; 
    border: 1px solid #7385a5; /* Border ditipiskan dikit biar rapi */
    
    /* Flexbox biar isi vertikal rapi */
    display: flex;
    flex-direction: column;
    justify-content: center; 
}

.meta-label { 
    font-size: 11px; /* Ukuran pas untuk label (Standar Industri) */
    text-transform: uppercase; 
    color: #7385a5; 
    letter-spacing: 0.5px; 
    font-weight: 600;
    margin-bottom: 5px; 
    line-height: 1.2;
}

.meta-value { 
    font-size: 14px; /* Ukuran isi data */
    font-weight: bold; 
    color: #5c6a84;
    word-wrap: break-word; /* Mencegah teks panjang merusak kotak */
}

/* --- 2. KHUSUS PC / TABLET (Layar Lebar) --- */
@media screen and (min-width: 992px) {
    .meta-grid {
        /* Di PC, kita paksa kotak lebih lebar lagi (Min 200px). 
           Ini akan membuat tampilan jadi 3 atau 4 kolom yang LEGA. */
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important; 
        gap: 20px;
    }
    
    .meta-value {
        font-size: 15px; /* Di PC dibesarkan sedikit isinya */
    }
}

        .silsilah-box { background: #e9f0ff; padding: 20px; border: 1px solid #7385a5; border-radius: 20px; }
        .silsilah-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #666; padding: 10px 0; }
        
        .social-section { margin-top: 40px; border-top: 1px dashed #5d4037; padding-top: 20px; }
        .review-box { background: #e9f0ff; padding: 20px; border-radius: 20px; border: 1px solid #7385a5; margin-bottom: 20px; }
        
        .star-rating span { font-size: 30px; cursor: pointer; color: #444; transition: 0.2s; }
        .star-rating span:hover, .star-rating span.active { color: gold; }
        
        .chip { background: #e9f0ff; color: #666; border: 1px solid #7385a5; padding: 8px 15px; border-radius: 20px; cursor: pointer; transition: 0.2s; margin-bottom: 5px; font-weight: bold; }
        .chip:hover, .chip.selected { background: #7385a5; color: #fff; font-weight: bold; }
        .review-card {
    background: #e9f0ff;
    padding: 15px;
    border: 1px solid #7385a5;
    margin-bottom: 15px;
    
    /* BENTUK CHAT BUBBLE (Sesuai Ikon Referensi) */
    /* Urutan: Kiri-Atas | Kanan-Atas | Kanan-Bawah | Kiri-Bawah */
    border-radius: 25px 25px 25px 0px !important;
    
    /* Opsional: Tambahkan sedikit shadow biar lebih pop-up */
    box-shadow: 2px 2px 5px rgba(115, 133, 165, 0.2);
        }
        
        .footer {
            background: #f6f9ff;
            padding: 20px 20px;
            margin-top: 25px;
            text-align: center;
            width: 100%; /* WAJIB FULL */
        }

        .social-icons { margin-bottom: 10px; }
        
        .social-link {
            display: inline-flex; justify-content: center; align-items: center;
            width: 35px; height: 35px; margin: 0 07px;
            border-radius: 50%; background: #7385a5; color: #fff;
            font-size: 15px; transition: all 0.3s ease; border: 1.5px solid #7385a5;
            text-decoration: none;
        }
        .social-link:hover {
            background: #fff; color: #7385a5;
            transform: translateY(-5px); box-shadow: 0 0 15px #7385a5;
        }

        .copyright { color: #888; font-size: 13px; letter-spacing: 1px; margin-top: 10px; }

    #toast {
    visibility: hidden;
    min-width: 220px;
    max-width: 85%;
    position: fixed;
    z-index: 99999;
    top: 90px;
    right: 20px;
    left: auto;
    background-color: rgba(51, 51, 51, 0.95);
    backdrop-filter: blur(8px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.15);
    color: #fff;
    padding: 10px 35px 10px 15px; 
    display: flex;
    align-items: center;
    font-family: 'Rubik', sans-serif;
    font-weight: 500;
    font-size: 11px;
    letter-spacing: 0.3px;
    opacity: 0;
    transform: translateX(20px) scale(0.9); 
    transition: all 0.4s cubic-bezier(0.2, 0, 0, 1), visibility 0s 0.4s; 
}

#toast.show {
    visibility: visible;
    opacity: 1;
    transform: translateX(0) scale(1);
    transition: all 0.4s cubic-bezier(0.2, 0, 0, 1), visibility 0s 0s;
}
    
#toast .toast-icon {
    width: 23px;
    height: 23px; 
    margin-right: 10px; 
    object-fit: contain;
}

#toast .toast-close {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 9px;
    height: 9px;
    cursor: pointer;
    opacity: 0.6;
    transition: 0.2s;
}

        #toast .toast-close:hover { opacity: 1; transform: scale(1.1); }

    #toast.info {
    background: rgba(0, 53, 107, 0.35);
    border: 1px solid rgba(0, 100, 204, 0.4);
    color: #fff;
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.35), 0 0 20px rgba(0, 100, 255, 0.25);
}

#toast.success {
    background: rgba(0, 77, 7, 0.35);
    color: #fff;
    border: 1px solid rgba(0, 184, 15, 0.4);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.35), 0 0 20px rgba(0,255,0,0.2);
}

#toast.error {
    background: rgba(107, 0, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(184, 0, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.40), 0 0 22px rgba(255,0,0,0.25);
    }

#toast.warning {
    background: rgba(102, 98, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(179, 171, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.40), 0 0 20px rgba(255,255,0,0.25);
}

#toast.wolf {
    background: rgba(125, 65, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(204, 106, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(255,140,0,0.25);
}

#toast.load {
    background: rgba(49, 77, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(104, 163, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(0,255,0,0.25);
}
    
#toast.loading {
    background: rgba(52, 90, 0, 0.35);
    color: #fff;
    border: 1px solid rgba(94, 163, 0, 0.45);
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    box-shadow: 0 8px 26px rgba(0,0,0,0.45), 0 0 20px rgba(94, 163, 0, 0.25);
}

@keyframes slideDown {
    from {top: -50px; opacity: 0;}
    to {top: 30px; opacity: 1;}
}

@keyframes fadeOut {
    from {top: 30px; opacity: 1;}
    to {top: -50px; opacity: 0;}
        }

        /* --- MODAL PREMIUM STYLE --- */

/* Latar Belakang Gelap (Overlay) */
.zoom-modal {
    display: none; 
    position: fixed; 
    z-index: 99999; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    background-color: rgba(0, 0, 0, 0.95); /* Lebih gelap biar fokus */
    backdrop-filter: blur(8px); /* Efek blur mahal */
    
    /* Flexbox untuk Centering Sempurna */
    align-items: center; 
    justify-content: center;
    overflow: hidden; /* Mencegah scroll di dalam modal */
}

/* Gambar Zoom */
.zoom-modal-content {
    max-width: 90%; 
    max-height: 90vh; /* Maksimal 90% tinggi layar */
    object-fit: contain; /* Gambar tidak akan gepeng */
    border-radius: 8px;
    box-shadow: 0 0 50px rgba(0,0,0,0.5); /* Shadow halus */
    transform: scale(0.9);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Animasi membal */
}

/* Class untuk Animasi Masuk */
.zoom-modal.active .zoom-modal-content {
    transform: scale(1);
    opacity: 1;
}

/* Tombol Close Premium */
.zoom-close {
    position: absolute;
    top: 10px;
    right: 25px;
    color: #e74c3c;
    background: rgba(255, 255, 255, 0.1);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255,255,255,0.2);
}

.zoom-close:hover {
    background: #e74c3c;
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    transform: rotate(90deg); /* Efek putar saat hover */
}

/* Cegah Scroll Body saat Modal Aktif */
body.modal-open {
    overflow: hidden;
}

        /* Style Dasar Tombol Premium */
.btn-premium {
    background: #7385a5; 
    color: white; 
    border: none; 
    padding: 12px 25px; 
    border-radius: 50px; 
    cursor: pointer; 
    width: 60%; 
    font-weight: bold; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    gap: 8px; 
    margin: 0 auto; 
    
    /* Efek Awal */
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); /* Transisi Super Smooth */
}

/* Efek Saat Hover (Disentuh Mouse) */
.btn-premium:hover {
    background: #5c6a84; /* Warna sedikit menua */
    transform: translateY(-3px) scale(1.02); /* Tombol naik sedikit & membesar halus */
    box-shadow: 0 10px 20px rgba(115, 133, 165, 0.4); /* Bayangan melebar lembut (Glow effect) */
}

/* Efek Saat Klik (Ditekan) */
.btn-premium:active {
    transform: translateY(-1px) scale(0.98); /* Efek membal saat ditekan */
    box-shadow: 0 5px 10px rgba(115, 133, 165, 0.3);
}

        /* Style Tombol Aksi Premium */
.btn-action-premium {
    background: transparent;
    border: 2px solid #7385a5;
    color: #7385a5;
    padding: 10px 24px;
    border-radius: 50px; /* Bulat sempurna */
    cursor: pointer;
    font-size: 15px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-weight: bold;
    
    /* Transisi Halus & Bayangan */
    box-shadow: 0 4px 6px rgba(115, 133, 165, 0.1);
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
}

/* Efek Hover (Saat Disentuh) */
.btn-action-premium:hover {
    background: #7385a5; /* Berubah jadi blok warna */
    color: #ffffff;      /* Teks jadi putih */
    transform: translateY(-3px); /* Naik sedikit */
    box-shadow: 0 10px 20px rgba(115, 133, 165, 0.3); /* Bayangan soft berwarna */
}

/* Efek Active (Saat Ditekan) */
.btn-action-premium:active {
    transform: translateY(-1px);
    box-shadow: 0 5px 10px rgba(115, 133, 165, 0.2);
}

/* Pastikan Icon ikut berubah warna */
.btn-action-premium i {
    transition: color 0.3s;
}
    </style>
</head>
<body>
<nav class="navbar">
        <div class="nav-left">
  <a href="index" style="display: flex; align-items: center; text-decoration: none;">
    <img src="img/icon-192.png" class="nav-logo" style="margin-right:8px;">
    <span class="nav-brand" style="font-size:20px; color: #7385a5; font-weight:bold;">Putramas Official</span>
  </a>
        </div>
        <div class="nav-right">
        <button id="btn-connect" onclick="connectWallet()">
            <i class="fas fa-wallet"></i> Hubungkan
        </button>
    </div>
</nav>

<div id="loading" style="text-align: center; margin-top: 100px; font-size: 14px; color: #7385a5; font-weight: 500; letter-spacing: 0.5px;">
    <i class="fas fa-circle-notch fa-spin" style="font-size: 22px; vertical-align: middle; margin-right: 10px;"></i> 
    Membuka Detail Arsip...
</div>

<div id="content" class="container" style="display: none;">
    <div class="left-col">
    <div class="img-frame wayang-img-wrapper" style="position: relative; display: inline-block; width: 100%;">
        
        <div class="id-badge" style="position: absolute; top: 10px; right: 10px; z-index: 30; 
             background: rgba(0, 0, 0, 0.6); color: #fff; padding: 5px 10px; 
             border-radius: 5px; font-weight: bold; font-size: 11px; pointer-events: none;">
            NFT ID: #<span id="displayId">0</span>
        </div>

        <img id="displayImg" src="" 
     onclick="openZoom(this)" 
     style="width: 100%; display: block; cursor: zoom-in;">
        </div>

    <div style="text-align: center; margin-top: 20px; color: #666; font-size: 12px;">
        Permanen di Base Mainnet
    </div>
    </div>

    <div id="myZoomModal" class="zoom-modal" onclick="closeZoom()">
    <div class="zoom-close" onclick="closeZoom()">
        <i class="fas fa-times"></i>
    </div>
    
    <img class="zoom-modal-content" id="img01">
    </div>

    <div class="right-col">
        <div>
            <h2 id="displayName">Nama Tokoh</h2>
            <span id="displayGaya" class="gaya-tag">Gaya</span>
        </div>
        
        <p class="description" id="displayDesc">Deskripsi...</p>

        <h3 style="color:#7385a5; border-bottom:1px solid #444; padding-bottom:5px;">Data Fisik & Budaya</h3>
        <div class="meta-grid">
            <div class="meta-box"><span class="meta-label">Golongan:</span><span class="meta-value" id="displayGolongan">-</span></div>
            <div class="meta-box"><span class="meta-label">Wanda:</span><span class="meta-value" id="displayWanda">-</span></div>
            <div class="meta-box"><span class="meta-label">Material Kulit:</span><span class="meta-value" id="displayKulit">-</span></div>
            <div class="meta-box"><span class="meta-label">Material Gapit:</span><span class="meta-value" id="displayGapit">-</span></div>
            <div class="meta-box"><span class="meta-label">Penatah:</span><span class="meta-value" id="displayPenatah">-</span></div>
            <div class="meta-box"><span class="meta-label">Penyungging:</span><span class="meta-value" id="displayPenyungging">-</span></div>
            <div class="meta-box"><span class="meta-label">Tahun Pembuatan:</span><span class="meta-value" id="displayTahun">-</span></div>
            <div class="meta-box"><span class="meta-label">Kolektor:</span><span class="meta-value" id="displayKolektor">-</span></div>
        </div>

        <h3 style="color:#7385a5; border-bottom:1px solid #444; padding-bottom:5px;">Silsilah & Asal Usul</h3>
        <div class="silsilah-box">
            <div class="silsilah-row"><span style="color:#666">Negara:</span><span style="font-weight:bold" id="displayNegara">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Ayah:</span><span style="font-weight:bold" id="displayAyah">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Ibu:</span><span style="font-weight:bold" id="displayIbu">-</span></div>
            <div class="silsilah-row"><span style="color:#666">Pusaka:</span><span style="font-weight:bold" id="displayPusaka">-</span></div>
        </div>

        <div class="social-section">
            
            <div style="margin-bottom: 25px;">

    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
        
        <button onclick="kirimLike()" id="btnLike" class="btn-action-premium">
    <i class="fas fa-heart"></i> 
    <span><span id="likeCount">0</span> Suka</span>
</button>

<button onclick="smartShare()" id="btnShare" class="btn-action-premium">
    <i class="fas fa-share-alt"></i>
    Bagikan
</button>
    </div>
    <br>
    <center><div style="margin-top: 8px; margin-left: 5px; color: #666; font-size: 12px; font-style: italic;">
        (Klik Suka & Ulasan)
    </div></center>

            </div>

            <div class="review-box">
    <h3 style="color: #7385a5; margin-top: 0; display:flex; align-items:center; gap:10px;">
        <i class="fas fa-pen-nib"></i> Beri Rating
    </h3><br>
    
    <div class="star-rating" style="margin-bottom: 15px; font-size: 24px;">
        <input type="hidden" id="selectedStar" value="0">
        
        <i class="fas fa-star" onclick="pilihBintang(1)" id="star-1" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(2)" id="star-2" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(3)" id="star-3" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(4)" id="star-4" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
        <i class="fas fa-star" onclick="pilihBintang(5)" id="star-5" style="cursor: pointer; color: #ccc; transition: 0.2s;"></i>
    </div>
    <br>
    <div style="margin-bottom: 20px;">
        <p style="color:#7385a5; font-size:12px; margin-bottom:8px; font-weight:bold;">
            <i class="fas fa-tags"></i> Pilih Ulasan:
        </p>
        <div id="pilihanUlasan" style="display: flex; gap: 8px; flex-wrap: wrap;">
            <button class="chip" onclick="pilihTag(this, 'Luar Biasa')"><i class="fas fa-thumbs-up"></i> Luar Biasa</button>
            <button class="chip" onclick="pilihTag(this, 'Sangat Detail')"><i class="fas fa-search-plus"></i> Sangat Detail</button>
            <button class="chip" onclick="pilihTag(this, 'Estetik')"><i class="fas fa-palette"></i> Estetik</button>
            <button class="chip" onclick="pilihTag(this, 'Super')"><i class="fas fa-bolt"></i> Super</button>
            <button class="chip" onclick="pilihTag(this, 'Masterpiece')"><i class="fas fa-crown"></i> Masterpiece</button>
            <button class="chip" onclick="pilihTag(this, 'Bersejarah')"><i class="fas fa-history"></i> Bersejarah</button>
        </div>
        <input type="hidden" id="selectedTag" value="">
    </div>

    <button onclick="kirimUlasan()" class="btn-premium">
    <i class="fas fa-paper-plane"></i> Kirim Ulasan
    </button>
            </div>

    <div style="margin-top: 30px; margin-bottom: 50px;">
    <h3 style="color: #7385a5; display:flex; align-items:center; gap:10px;">
    <i class="fas fa-comments"></i> 
    Ulasan Pengunjung 
    (<span style="color: #00b300;" id="reviewCount">0</span>)
    </h3>
    
    <div id="reviewContainer" style="min-height: 50px;">
        <p style="color:#999; text-align:center; font-style:italic;">
            <i class="fas fa-spinner fa-spin"></i> Memuat data...
        </p>
    </div>
    </div>
</div>
</div>
</div>
            
<div id="toast"></div>

<footer class="footer">
        <div class="footer-content">
            <div class="social-icons">
                <a href="https://youtube.com/@PutramasOfficial" target="_blank" class="social-link"><i class="fab fa-youtube"></i></a>
                <a href="https://instagram.com/putramas_official" target="_blank" class="social-link"><i class="fab fa-instagram"></i></a>
                <a href="https://facebook.com/PutramasOfficial" target="_blank" class="social-link"><i class="fab fa-facebook-f"></i></a>
                <a href="https://facebook.com/PutramasOfficialStudio" target="_blank" class="social-link"><i class="fab fa-facebook-f"></i></a>
            </div>
            <p class="copyright">
                &copy; <span id="year"></span> Powered By <strong>Putramas Official</strong>
            </p>
        </div>
</footer>

<script>
    const CONTRACT_ADDRESS = "0x29f19E566380DC680357d30fbfFc7EB7DD02947B"; // <--- Paste Contract Address Disini
    
    const BASE_SEPOLIA_ID = '0x14a34'; // 84532
    const BASE_SEPOLIA_RPC = 'https://sepolia.base.org';
    const BASE_SEPOLIA_CONFIG = {
        chainId: BASE_SEPOLIA_ID,
        chainName: 'Base Sepolia Testnet',
        nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
        rpcUrls: [BASE_SEPOLIA_RPC],
        blockExplorerUrls: ['https://sepolia.basescan.org']
    };

    const CONTRACT_ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newFee","type":"uint256"}],"name":"FeeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"}],"name":"Liked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"star","type":"uint8"},{"indexed":false,"internalType":"string","name":"ulasan","type":"string"}],"name":"Reviewed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"nama","type":"string"},{"indexed":false,"internalType":"string","name":"golongan","type":"string"}],"name":"WayangLahir","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"nama","type":"string"},{"indexed":false,"internalType":"string","name":"golongan","type":"string"},{"indexed":false,"internalType":"bool","name":"isOfficial","type":"bool"},{"indexed":false,"internalType":"address","name":"creator","type":"address"}],"name":"WayangLahir","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"namaBaru","type":"string"},{"indexed":false,"internalType":"string","name":"uriBaru","type":"string"}],"name":"WayangUpdate","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_penerima","type":"address"},{"internalType":"string","name":"_tokenURI","type":"string"},{"internalType":"string","name":"_nama","type":"string"},{"internalType":"string","name":"_golongan","type":"string"},{"internalType":"string","name":"_gaya","type":"string"}],"name":"arsipWayang","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"dalang","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"emergencyWithdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getAverageRating","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"golongan","type":"string"}],"name":"getIdsByGolongan","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getInfoWayang","outputs":[{"components":[{"internalType":"string","name":"nama","type":"string"},{"internalType":"string","name":"golongan","type":"string"},{"internalType":"string","name":"gaya","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"},{"internalType":"bool","name":"isOfficial","type":"bool"},{"internalType":"address","name":"creator","type":"address"}],"internalType":"struct WayangArsipPutramasOfficial.WayangInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getReviews","outputs":[{"components":[{"internalType":"address","name":"reviewer","type":"address"},{"internalType":"uint8","name":"bintang","type":"uint8"},{"internalType":"string","name":"ulasan","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"internalType":"struct WayangArsipPutramasOfficial.Review[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"hasLiked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"hasReviewed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"kasihLike","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"_bintang","type":"uint8"},{"internalType":"string","name":"_ulasanPilihan","type":"string"}],"name":"kasihUlasan","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicMintFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"string","name":"_namaBaru","type":"string"},{"internalType":"string","name":"_uriBaru","type":"string"}],"name":"revisiDataWayang","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newFee","type":"uint256"}],"name":"setMintFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"totalLikes","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_tokenURI","type":"string"},{"internalType":"string","name":"_nama","type":"string"},{"internalType":"string","name":"_golongan","type":"string"},{"internalType":"string","name":"_gaya","type":"string"}],"name":"uploadPublik","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"walletOfOwner","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"wayangRegistry","outputs":[{"internalType":"string","name":"nama","type":"string"},{"internalType":"string","name":"golongan","type":"string"},{"internalType":"string","name":"gaya","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"},{"internalType":"bool","name":"isOfficial","type":"bool"},{"internalType":"address","name":"creator","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"wayangReviews","outputs":[{"internalType":"address","name":"reviewer","type":"address"},{"internalType":"uint8","name":"bintang","type":"uint8"},{"internalType":"string","name":"ulasan","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"stateMutability":"view","type":"function"}];
        
    let provider;
    let signer;
    let toastTimeout;

    async function init() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (!id) {
            document.getElementById("loading").innerText = "Gagal: ID Arsip tidak ditemukan.";
            return;
        }

        if(window.ethereum && window.ethereum.selectedAddress) {
             connectWallet();
        }

        await loadDetail(id);
        await loadSocialData(id);
    }

    async function connectWallet() {
        if (!window.ethereum) return showToast("Install Metamask Atau EVM Wallet Dulu!", 'wolf');

        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            
            const network = await provider.getNetwork();
            if (network.chainId !== 84532) {
                await switchNetwork();
            }

            signer = provider.getSigner();
            const address = await signer.getAddress();
            
            const btn = document.getElementById("btn-connect");
            btn.innerText = address.substring(0,6) + "...";
            btn.classList.add("connected");

        } catch (err) {
            console.error(err);
            showToast("Gagal koneksi: " + err.message, 'error');
        }
    }

    async function switchNetwork() {
        try {
            await window.ethereum.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: BASE_SEPOLIA_ID }],
            });
        } catch (switchError) {
            if (switchError.code === 4902) {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [BASE_SEPOLIA_CONFIG],
                });
            } else {
                throw switchError;
            }
        }
    }

        async function loadDetail() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    if (!id) return;

    try {
        const provider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);

        // 1. Ambil Owner & Data
        const owner = await contract.ownerOf(id);
        const uri = await contract.tokenURI(id);
        const httpUri = uri.replace("ipfs://", "https://ipfs.io/ipfs/");
        const response = await axios.get(httpUri);
        const meta = response.data;

        // 2. Cek User Address (Untuk keperluan validasi nanti saat klik)
        if (window.ethereum) {
            const accounts = await window.ethereum.request({ method: 'eth_accounts' });
            if (accounts.length > 0) userAddress = accounts[0];
        }
        
        const rawImgUrl = meta.image.replace("ipfs://", "https://ipfs.io/ipfs/");
        const hdImageUrl = `https://wsrv.nl/?url=${encodeURIComponent(rawImgUrl)}&w=1200&q=95&output=webp`;
        
        // Helper GetAttr (Saya tambahkan toLowerCase agar lebih aman mendeteksi key)
        const getAttr = (k) => {
            if(!meta.attributes) return "-";
            const f = meta.attributes.find(a => a.trait_type.toLowerCase() === k.toLowerCase());
            return f ? f.value : "-";
        };

        document.getElementById("displayId").innerText = id;
        
        const imgEl = document.getElementById("displayImg");
        imgEl.src = hdImageUrl;
        imgEl.style.opacity = 0;
        imgEl.onload = () => { imgEl.style.opacity = 1; imgEl.style.transition = "opacity 0.5s"; };

        document.getElementById("displayName").innerText = meta.name;
        document.getElementById("displayGaya").innerText = getAttr("Gaya");

        // --- UPDATE UI STANDAR PROFESIONAL (FIXED VERSION) ---

        // 1. Definisikan Elemen Target
        const titleElement = document.getElementById('displayName'); 

        // 2. Siapkan Data User (AMBIL LANGSUNG DARI METAMASK BIAR TIDAK ERROR)
        let currentUser = "";
        try {
            if (window.ethereum && window.ethereum.selectedAddress) {
                currentUser = window.ethereum.selectedAddress;
            }
        } catch (e) { console.log("Wallet belum connect"); }

        const shortOwner = owner.substring(0, 6) + "..." + owner.substring(owner.length - 4);

        // --- 6. PINDAHKAN BADGE GAYA (CIREBON) KE HEADER ---
        
        // A. Ambil Text Gaya (Misal: "Cirebon")
        const textGaya = getAttr("Gaya");

        if (textGaya) {
            // B. Sembunyikan Elemen Gaya yang Lama (yang ada di bawah)
            // Supaya tidak muncul double
            const oldGayaEl = document.getElementById("displayGaya");
            if (oldGayaEl) {
                // Sembunyikan elemen ini (atau parent-nya jika perlu)
                oldGayaEl.style.display = 'none'; 
                
                // Opsional: Jika displayGaya ada di dalam container khusus (misal .badge-container), sembunyikan container itu juga
                if(oldGayaEl.parentElement && oldGayaEl.parentElement.className.includes('badge')) {
                     oldGayaEl.parentElement.style.display = 'none';
                }
            }

            // C. Buat HTML Badge Gaya Baru (Style Pill Biru Elegan)
            const newGayaBadge = `
                <span title="Gaya / Asal" 
                      style="background:#5c6a84; color:white; padding:4px 12px; border-radius:50px; 
                             font-size:11px; font-weight:600; vertical-align:middle; margin-left:8px; 
                             display:inline-flex; align-items:center; border:1px solid rgba(255,255,255,0.2); 
                             transform:translateY(-1px);">
                    <i class="fas fa-map-marker-alt" style="margin-right:4px; font-size:10px;"></i> ${textGaya}
                </span>
            `;

            // D. Masukkan ke dalam Judul (displayName)
            // 'beforeend' artinya ditaruh di urutan paling akhir di dalam H2 (Setelah Teks Judul & Bintang)
            document.getElementById("displayName").insertAdjacentHTML('beforeend', newGayaBadge);
        }
        
        // Cek Pemilik dengan aman
        const isMyItem = (currentUser && currentUser.toLowerCase() === owner.toLowerCase());

        // 3. Buat HTML Badge Kontributor (Di Bawah Judul)
        const contributorHTML = `
            <div id="contributor-badge-area" style="display:flex; align-items:center; gap:10px; margin-top:5px; margin-bottom:15px;">
                <a href="profile?address=${owner}" style="text-decoration:none; display:flex; align-items:center; gap:6px; background:#eef2f7; padding:5px 12px; border: 2px solid #7385a5; border-radius:50px; transition:0.2s;">
                    <img src="https://api.dicebear.com/7.x/identicon/svg?seed=${owner}" style="width:20px; height:20px; border-radius:50%;">
                    <span style="font-size:12px; font-weight:600; color:#0360ff;">Pemilik: ${shortOwner}</span>
                </a>
                ${isMyItem ? `
                    <span style="font-size:12px; color:#f1c40f; background:rgba(241, 196, 15, 0.1); padding:5px 12px; border-radius:50px; font-weight:bold;">
                        Milik Anda
                    </span>
                ` : ''}
            </div>
        `;

        // 4. Buat HTML Tombol Revisi (Icon Only)
        // Menggunakan insertAdjacentHTML agar lebih aman daripada innerHTML+=
        const editIconHTML = `
            <button onclick="handleEditClick('${id}', '${owner}')" title="Revisi Data"
                style="background:#d35400; padding:4px 12px; border:2pxsolid#d35400; border-radius:50px; cursor:pointer; color:#fff; font-size:11px; font-weight:600; margin-left:10px; vertical-align:middle; transition:0.2s;"
                onmouseover="this.style.transform='scale(1.2)'" 
                onmouseout="this.style.transform='scale(1)'">
                <i class="fas fa-pen-to-square"></i>Revisi
            </button>
        `;

        // 5. EKSEKUSI RENDER
        
        // A. Masukkan Kontributor (Cek dulu biar tidak dobel)
        if (!document.getElementById('contributor-badge-area')) {
            // Masukkan SETELAH elemen judul (h2)
            titleElement.insertAdjacentHTML('afterend', contributorHTML);
        }

        // B. Masukkan Tombol Edit (Di DALAM judul, sebelah teks)
        if (isMyItem) {
            // Cek apakah tombol sudah ada? Kalau belum, masukkan.
            if (!titleElement.querySelector('button')) {
                titleElement.insertAdjacentHTML('beforeend', editIconHTML);
            }
        }
        
        // --- LANJUT DATA LAINNYA ---
        document.getElementById("displayDesc").innerText = meta.description;
        document.getElementById("displayGolongan").innerText = getAttr("Golongan");
        document.getElementById("displayWanda").innerText = getAttr("Wanda");
        document.getElementById("displayKulit").innerText = getAttr("Material Kulit");
        document.getElementById("displayGapit").innerText = getAttr("Material Gapit");
        document.getElementById("displayPenatah").innerText = getAttr("Penatah");
        document.getElementById("displayPenyungging").innerText = getAttr("Penyungging");
        document.getElementById("displayTahun").innerText = getAttr("Tahun Pembuatan");
        document.getElementById("displayKolektor").innerText = getAttr("Kolektor");
        
        document.getElementById("displayNegara").innerText = getAttr("Negara");
        document.getElementById("displayAyah").innerText = getAttr("Ayah");
        document.getElementById("displayIbu").innerText = getAttr("Ibu");
        document.getElementById("displayPusaka").innerText = getAttr("Pusaka") || "-";

        document.getElementById("loading").style.display = "none";
        document.getElementById("content").style.display = "flex";

    } catch (err) {
        console.error("Error Detail:", err);
        document.getElementById("loading").innerText = "Gagal memuat data wayang. Cek koneksi.";
    }
} // Tutup kurung fungsi loadDetail

    // Fungsi Handler Klik Tombol Revisi
function handleEditClick(id, owner) {
    // 1. Cek apakah Wallet sudah terhubung
    if (!userAddress) {
        showToast("Hubungkan wallet untuk mengedit!", 'warning');
        return;
    }

    // 2. Cek apakah Wallet yang login adalah Pemilik
    if (userAddress.toLowerCase() !== owner.toLowerCase()) {
        showToast("Anda bukan pemilik postingan ini!", 'error');
        return;
    }

    // 3. Jika Lolos Validasi -> Pindah ke Halaman Revisi
    window.location.href = `revisi?id=${id}`;
}

    async function loadSocialData(id) {
    try {
        const readProvider = new ethers.providers.JsonRpcProvider(BASE_SEPOLIA_RPC);
        const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, readProvider);
        
        // 1. Load Likes
        const likes = await contract.totalLikes(id);
        const likeEl = document.getElementById("likeCount");
        if(likeEl) likeEl.innerText = likes.toString();
        
        // 2. Load Reviews
        const reviews = await contract.getReviews(id);
        
        // --- RATING RATA-RATA (FIX DUPLIKAT) ---
        try {
            const avgScore = await contract.getAverageRating(id);
            const finalScore = (avgScore / 10).toFixed(1);
            
            if(avgScore > 0) {
                const nameEl = document.getElementById("displayName");
                
                // 1. Cek apakah badge rating sudah ada?
                let ratingBadge = document.getElementById("rating-badge-dynamic");

                // 2. Jika BELUM ada, kita buat element baru
                if (!ratingBadge) {
                    ratingBadge = document.createElement("span");
                    ratingBadge.id = "rating-badge-dynamic"; // Kasih ID biar dikenali
                    
                    // Style CSS (Sama seperti sebelumnya)
                    ratingBadge.style.cssText = "font-size:14px; color:#f1c40f; border:1px solid #f1c40f; padding:2px 8px; border-radius:15px; display:inline-flex; align-items:center; gap:4px; vertical-align: middle; margin-left: 10px;";
                    
                    // Masukkan ke sebelah Nama
                    nameEl.appendChild(ratingBadge);
                }

                // 3. Update Isinya (Baik itu baru dibuat atau sudah ada)
                // Ini menjamin isinya cuma satu dan angkanya selalu update
                ratingBadge.innerHTML = `<i class="fas fa-star"></i> ${finalScore}`;
            }
        } catch (e) {
            console.log("Belum ada rating rata-rata");
    }
        
        // Update Jumlah Review
        const countEl = document.getElementById("reviewCount");
        if(countEl) countEl.innerText = reviews.length;
        
        const container = document.getElementById("reviewContainer");
        
        // --- LOOPING ULASAN ---
        if(reviews.length === 0) {
            container.innerHTML = `<p style="color:#666; font-style: italic; text-align:center; padding:20px;">
                <i class="far fa-comment-dots"></i> Belum ada ulasan. Jadilah yang pertama!
            </p>`;
        } else {
            container.innerHTML = ""; // Bersihkan loading
            [...reviews].reverse().forEach(r => {
                const bintangHtml = '<i class="fas fa-star" style="margin-right:2px;"></i>'.repeat(r.bintang);
                
                // PERBAIKAN: Hapus style inline di div utama agar class .review-card dari CSS terpakai
                const html = `
                    <div class="review-card"> 
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; border-bottom:1px dashed #ccc; padding-bottom:5px;">
                            <div style="font-size: 12px; color: #5c6a84; font-weight:bold;">
                                <i class="fas fa-user-circle"></i> ${r.reviewer.substring(0,6)}...${r.reviewer.substring(38)}
                            </div>
                            <div style="color: #f1c40f; font-size: 12px;">${bintangHtml}</div>
                        </div>
                        <div style="color: #444; font-size: 13px; line-height: 1.4;">
                            <i class="fas fa-quote-left" style="color:#ccc; font-size:10px; vertical-align:top; margin-right:5px;"></i> 
                            ${r.ulasan}
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        loadSocialData(id);
    }

    } catch (err) {
        console.error("Gagal load social:", err);
    }
        }
    
    async function ensureWallet() {
        if(!signer) {
            await connectWallet();
            if(!signer) throw new Error("Wallet belum terkoneksi");
        }
    }

    async function kirimLike() {
        try {
            await ensureWallet();
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
            
            const btn = document.getElementById("btnLike");
            const oriText = btn.innerHTML;
            btn.innerHTML = `
            <i class="fas fa-circle-notch fa-spin" style="margin-right: 8px;"></i>Send...
           `;
            const tx = await contract.kasihLike(id);
            await tx.wait();
            
            showToast("Berhasil Like!", 'success');
            location.reload();

        } catch(err) {
            showToast("Gagal: " + (err.reason || err.message), 'error');
            document.getElementById("btnLike").innerHTML = '<i class="fas fa-heart" style="color: #fff; margin-right: 6px;"></i> Menyukai';
        }
    }

    async function kirimUlasan() {
        try {
            const bintang = document.getElementById("selectedStar").value;
            const tag = document.getElementById("selectedTag").value;
            if(bintang == 0 || tag == "") return showToast("Pilih bintang & kata ulasan dulu!", 'warning');

            await ensureWallet();
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
            
            const tx = await contract.kasihUlasan(id, bintang, tag);
            showToast("Transaksi review dikirim. Tunggu konfirmasi...", 'loading');
            await tx.wait();
            
            showToast("Review Berhasil!", 'success');
            location.reload();

        } catch(err) {
            showToast("Gagal: " + (err.reason || err.message), 'error');
        }
    }

    function pilihBintang(n) {
    // 1. Simpan nilai ke input hidden
    document.getElementById("selectedStar").value = n;

    // 2. Ambil semua elemen 'i' (icon), BUKAN 'span'
    const stars = document.querySelectorAll('.star-rating i');

    // 3. Loop untuk ubah warna
    stars.forEach((s, index) => {
        if(index < n) {
            // Jika urutan bintang di bawah n, warnai Emas
            s.style.color = "#f1c40f"; 
        } else {
            // Sisanya warnai Abu-abu
            s.style.color = "#ccc"; 
        }
    });
    }

    function pilihTag(btn, teks) {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
        btn.classList.add('selected');
        document.getElementById("selectedTag").value = teks;
    }

    async function smartShare() {
    const shareData = {
        title: document.title,
        text: 'Lihat koleksi Wayang Nusantara ini! Sangat detail dan estetik.',
        url: window.location.href
    };

    const btnShare = document.getElementById("btnShare");
    const originalText = btnShare.innerHTML;

    if (navigator.share) {
        try {
            await navigator.share(shareData);
            console.log('Berhasil dibagikan');
        } catch (err) {
            console.log('Batal membagikan');
        }
    } else {
        try {
            await navigator.clipboard.writeText(window.location.href);
            btnShare.innerHTML = `<img src="img/success.svg" style="width: 19px; height: 19px; vertical-align: middle;"> Link Disalin!`;
            setTimeout(() => {
                btnShare.innerHTML = originalText;
            }, 2000);
        } catch (err) {
            showToast("Gagal menyalin link: " + err, 'error');
        }
    }
    }

    // --- FUNGSI ZOOM PREMIUM ---

function openZoom(element) {
    const modal = document.getElementById("myZoomModal");
    const modalImg = document.getElementById("img01");
    
    // 1. Set Sumber Gambar
    modalImg.src = element.src; 
    
    // 2. Tampilkan Modal (Flex agar centering jalan)
    modal.style.display = "flex"; 
    
    // 3. Kunci Scroll Body (Biar gak goyang)
    document.body.classList.add("modal-open");

    // 4. Trigger Animasi (Sedikit delay agar transisi jalan)
    setTimeout(() => {
        modal.classList.add("active");
    }, 10);
}

function closeZoom() {
    const modal = document.getElementById("myZoomModal");
    
    // 1. Hilangkan Animasi
    modal.classList.remove("active");
    
    // 2. Tunggu animasi selesai baru sembunyikan (300ms sesuai CSS transition)
    setTimeout(() => {
        modal.style.display = "none";
        // 3. Lepas Kunci Scroll Body
        document.body.classList.remove("modal-open");
    }, 300);
}

    function showToast(msg, type = 'info') {
    const x = document.getElementById("toast");

    const icons = {
        info: 'img/info-icon.svg',
        load: 'img/load.svg',
        loading: 'img/loading.svg',
        success: 'img/success.svg',
        error: 'img/error.svg',
        warning: 'img/warning.svg',
        wolf: 'img/wolf.svg'
    };

    const closeIcon = 'img/x.svg'; 

    if (!icons[type]) type = 'info';

    x.innerHTML = `
        <img src="${icons[type]}" class="toast-icon" alt="${type}"> 
        <span style="flex:1;">${msg}</span>
        <img src="${closeIcon}" class="toast-close" onclick="this.parentElement.className = this.parentElement.className.replace('show', '')" alt="close">
    `;

    x.className = ''; 
    void x.offsetWidth; 
    x.className = `show ${type}`;

    if (toastTimeout) clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => { 
        x.className = x.className.replace("show", ""); 
    }, 10000); 
    }

    init();
document.getElementById("year").innerText = new Date().getFullYear();
</script>
</script>
</body>
</html>
