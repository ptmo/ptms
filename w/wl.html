<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA SECURE SOLANA VAULT</title>
    
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
    
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #e2e8f0; --accent: #14f195; --danger: #ef4444; }
        body { font-family: 'Courier New', monospace; background: var(--bg); color: var(--text); padding: 20px; text-align: center; }
        
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Status Banner */
        #status-banner { padding: 15px; font-weight: bold; margin-bottom: 20px; border-radius: 8px; transition: 0.3s; }
        .online { background: var(--danger); color: white; animation: pulse 2s infinite; }
        .offline { background: var(--accent); color: black; }

        /* Sections */
        .section { background: var(--card); padding: 25px; border-radius: 12px; margin-bottom: 20px; display: none; border: 1px solid #334155; }
        .active { display: block; }

        input, textarea { width: 90%; padding: 12px; background: #000; color: var(--accent); border: 1px solid #475569; border-radius: 6px; margin: 10px 0; font-family: inherit; }
        button { background: var(--accent); color: #000; padding: 12px 24px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; border-radius: 6px; margin: 5px; }
        button:disabled { background: #475569; cursor: not-allowed; opacity: 0.5; }
        button.danger { background: var(--danger); color: white; }

        .token-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #334155; }
        .price-up { color: var(--accent); }
        .price-down { color: var(--danger); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h1> SOLANA SECURE VAULT</h1>
    
    <div id="status-banner" class="online">
        ‚ö†Ô∏è INTERNET TERDETEKSI! MATIKAN WIFI UNTUK AKSES BRANKAS.
    </div>

    <div id="secure-gate" class="section">
        <h2>üîê BRANKAS OFFLINE</h2>
        <p>Fitur ini hanya aktif jika internet MATI total.</p>
        
        <div style="margin: 20px 0;">
            <button onclick="createWallet()" id="btn-create">GENERATE NEW WALLET</button>
            <p>- ATAU -</p>
            <textarea id="input-phrase" placeholder="Paste Seed Phrase / Private Key disini..." rows="3"></textarea>
            <button onclick="importWallet()" id="btn-import">IMPORT & PROCESS</button>
        </div>

        <div id="result-area" style="display:none; text-align:left; background:black; padding:15px; border: 1px solid var(--accent);">
            <p style="color:yellow">‚ö†Ô∏è SALIN SEKARANG! DATA AKAN HILANG SAAT REFRESH.</p>
            <p><strong>Public Key (Address):</strong> <span id="out-pub" style="color:white"></span></p>
            <p><strong>Secret Phrase:</strong> <span id="out-priv" style="color:var(--accent); filter: blur(5px); cursor: pointer;" onclick="this.style.filter='none'">KLIK UNTUK LIHAT</span></p>
        </div>
    </div>

    <div id="dashboard" class="section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>üìà ASET DASHBOARD</h2>
            <button onclick="logout()" class="danger">LOGOUT / CLEAR RAM</button>
        </div>
        
        <div style="background:#000; padding:15px; border-radius:8px; margin-bottom:20px;">
            <small>Wallet Address:</small><br>
            <strong id="dash-pubkey" style="color:var(--accent); font-size:1.2em;">-</strong>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px;">
            <div style="background:#334155; padding:15px; border-radius:8px;">
                <small>Total Balance (Est)</small>
                <h3 id="total-usd">$0.00</h3>
            </div>
            <div style="background:#334155; padding:15px; border-radius:8px;">
                <small>SOL Price</small>
                <h3 id="sol-price">Loading...</h3>
            </div>
        </div>

        <h3>Token Holdings</h3>
        <div id="token-list">
            <p>Scanning blockchain...</p>
        </div>
    </div>
</div>

<script>
    // --- KONFIGURASI DAN VARIABEL RAM ---
    let userPublicKey = null; // Hanya Public Key yang boleh disimpan permanen di sesi ini
    const HELIUS_RPC = "https://api.mainnet-beta.solana.com"; // Gunakan RPC Publik
    
    // --- 1. SISTEM DETEKSI JARINGAN (THE ENFORCER) ---
    function updateNetworkStatus() {
        const banner = document.getElementById('status-banner');
        const gate = document.getElementById('secure-gate');
        const dash = document.getElementById('dashboard');
        const btns = document.querySelectorAll('#secure-gate button');

        if (navigator.onLine) {
            // ONLINE MODE
            banner.className = 'online';
            banner.innerText = "‚ö†Ô∏è INTERNET ONLINE: INPUT KUNCI DIBLOKIR UNTUK KEAMANAN.";
            
            // Matikan tombol create/import
            btns.forEach(b => b.disabled = true);
            
            // Jika Public Key sudah ada (User sudah login), tampilkan Dashboard
            if (userPublicKey) {
                gate.style.display = 'none';
                dash.style.display = 'block';
                fetchDashboardData();
            } else {
                gate.style.display = 'block'; // Tampilkan gate tapi disabled
                dash.style.display = 'none';
            }

        } else {
            // OFFLINE MODE
            banner.className = 'offline';
            banner.innerText = "‚úÖ INTERNET OFFLINE: MODE AMAN DIAKTIFKAN. SILAKAN PROSES WALLET.";
            
            // Hidupkan tombol
            btns.forEach(b => b.disabled = false);
            
            // Sembunyikan Dashboard (karena butuh internet)
            dash.style.display = 'none';
            gate.style.display = 'block';
        }
    }

    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);
    updateNetworkStatus(); // Cek saat load awal

    // --- 2. LOGIKA BRANKAS (OFFLINE) ---
    // Fungsi ini hanya bisa jalan jika internet mati (tombol enabled)
    
    async function createWallet() {
        const mnemonic = bip39.generateMnemonic();
        processKey(mnemonic);
    }

    async function importWallet() {
        const input = document.getElementById('input-phrase').value.trim();
        if (!input) return alert("Masukkan Phrase/PK!");
        processKey(input);
    }

    async function processKey(inputSecret) {
        try {
            let keypair;
            
            // Deteksi apakah Mnemonic atau Private Key
            if (inputSecret.includes(" ")) {
                // Mnemonic Logic
                const seed = await bip39.mnemonicToSeed(inputSecret);
                // Derivation Path Standar Solana (m/44'/501'/0'/0')
                // Note: Untuk demo simplifikasi kita pakai seed slice (native CLI style)
                // Untuk kompatibilitas Phantom 100%, butuh ed25519-hd-key (library tambahan)
                // Kita gunakan Keypair from seed slice untuk universalitas dasar
                const seedSlice = seed.slice(0, 32); 
                keypair = solanaWeb3.Keypair.fromSeed(seedSlice);
            } else {
                // Private Key (Base58) Logic
                // Note: Butuh bs58 decoder. Untuk simplifikasi tanpa library external berat:
                // Kita asumsikan user input array angka JSON atau kita skip validasi PK raw
                alert("Fitur Import PK Raw butuh library bs58. Gunakan Mnemonic untuk demo ini.");
                return;
            }

            // SIMPAN PUBLIC KEY KE RAM
            userPublicKey = keypair.publicKey.toString();

            // TAMPILKAN HASIL SEMENTARA (Akan hilang saat user refresh)
            document.getElementById('out-pub').innerText = userPublicKey;
            document.getElementById('out-priv').innerText = inputSecret;
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('input-phrase').value = ""; // Hapus input form

            alert("‚úÖ Wallet Berhasil Diproses di RAM!\n\n1. Catat Phrase/PK Anda di kertas sekarang.\n2. NYALAKAN INTERNET untuk melihat dashboard.");

            // Hapus Variable Sensitive dari memori fungsi ini segera
            keypair = null;
            inputSecret = null;

        } catch (e) {
            alert("Error: " + e.message);
        }
    }

    // --- 3. LOGIKA DASHBOARD (ONLINE) ---
    async function fetchDashboardData() {
        if (!navigator.onLine || !userPublicKey) return;

        document.getElementById('dash-pubkey').innerText = userPublicKey;
        const connection = new solanaWeb3.Connection(HELIUS_RPC);
        const pubKeyObj = new solanaWeb3.PublicKey(userPublicKey);

        // A. Ambil Saldo SOL
        const balance = await connection.getBalance(pubKeyObj);
        const solBalance = balance / 1000000000;

        // B. Ambil Harga SOL via API (Jupiter/CoinGecko)
        try {
            const priceRes = await fetch(`https://api.jup.ag/price/v2?ids=So11111111111111111111111111111111111111112`);
            const priceData = await priceRes.json();
            const solPrice = priceData.data['So11111111111111111111111111111111111111112'].price;

            document.getElementById('sol-price').innerText = `$${parseFloat(solPrice).toFixed(2)}`;
            
            const totalEst = solBalance * solPrice;
            document.getElementById('total-usd').innerText = `$${totalEst.toFixed(2)}`;

            // List Token (SOL Only untuk demo, Token SPL butuh parsing layout data yg kompleks)
            const list = document.getElementById('token-list');
            list.innerHTML = `
                <div class="token-item">
                    <span><strong>SOL</strong> (Native)</span>
                    <div style="text-align:right">
                        <div>${solBalance.toFixed(4)} SOL</div>
                        <div style="font-size:0.8em; color:#94a3b8">$${(solBalance * solPrice).toFixed(2)}</div>
                    </div>
                </div>
            `;
        } catch (e) {
            console.error("Gagal ambil harga", e);
        }
    }

    function logout() {
        location.reload(); // Hard Refresh untuk membersihkan seluruh RAM
    }
</script>

</body>
</html>
