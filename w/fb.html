<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro FB Downloader - Private Mode</title>
    <style>
        /* CSS NATIVE - Tanpa Framework, Mudah Diubah */
        :root {
            --primary: #2563eb;
            --bg-gradient: radial-gradient(circle at 0% 0%, #f1f5f9 0%, #cbd5e1 100%);
            --glass: rgba(255, 255, 255, 0.8);
            --text-main: #1e293b;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 500px;
            padding: 40px;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border-radius: 30px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            text-align: center;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.05);
            padding: 5px;
            border-radius: 12px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: transparent;
            font-weight: 600;
            transition: 0.3s;
        }

        .tab-btn.active {
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            color: var(--primary);
        }

        .input-group { margin-bottom: 20px; }

        label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; }

        textarea, input {
            width: 100%;
            padding: 15px;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 15px;
            box-sizing: border-box;
            background: white;
            font-size: 14px;
            outline: none;
            transition: 0.3s;
        }

        textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }

        .btn-main {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-main:hover { opacity: 0.9; transform: translateY(-1px); }

        #result {
            margin-top: 25px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 20px;
            display: none;
            text-align: center;
        }

        .download-links { display: flex; gap: 10px; margin-top: 15px; }

        .dl-card {
            flex: 1;
            padding: 12px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-main);
            font-size: 14px;
            font-weight: bold;
        }

        .dl-card.hd { background: var(--primary); color: white; border: none; }

        .instructions {
            font-size: 12px;
            color: #64748b;
            margin-top: 10px;
            line-height: 1.5;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>FB Downloader <span style="color:var(--primary)">Pro</span></h1>
    </div>

    <div class="input-group">
    <label>Link Video (URL)</label>
    <input type="text" id="fbUrl" placeholder="https://www.facebook.com/watch/...">
    <button onclick="openSourceHP()" style="margin-top:10px; background:#64748b; font-size:12px;" class="btn-main">
        1. Buka Kode Sumber (Tab Baru)
    </button>
</div>

<div class="input-group">
    <label>2. Tempel Kode Sumber di Sini</label>
    <textarea id="fbSource" rows="5" placeholder="Tempel semua kode teks di sini..."></textarea>
</div>

<button onclick="processVideo()" id="btnAction" class="btn-main">3. Ekstrak Video Sekarang</button>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchMode('public')">Public</button>
        <button class="tab-btn" onclick="switchMode('private')">Private</button>
    </div>

    <div id="publicMode">
        <div class="input-group">
            <label>Link Video Facebook</label>
            <input type="text" id="fbUrl" placeholder="https://www.facebook.com/watch/...">
        </div>
    </div>

    <div id="privateMode" style="display:none; padding:15px; background: #fff; border-radius: 20px; border: 1px solid #ddd;">
    <h3 style="font-size: 16px; margin-bottom: 10px;">Panduan Ambil Video Private:</h3>
    <ol style="font-size: 13px; line-height: 1.6; padding-left: 20px; color: #444;">
        <li>Buka video di Facebook sampai terputar.</li>
        <li>Ketik <b>view-source:</b> di depan alamat URL video tersebut.</li>
        <li>Salin semua teks kode yang muncul.</li>
        <li>Tempelkan ke kotak di bawah ini.</li>
    </ol>
    
    <textarea id="fbSource" rows="6" placeholder="Tempel kode di sini..." 
        style="width:100%; margin-top:10px; border:1px solid #ccc; border-radius:10px; padding:10px;"></textarea>
    </div>
    
    <div id="result">
        <p style="margin:0; font-size:14px; color:#64748b">Video Ditemukan!</p>
        <div class="download-links">
            <a id="sdLink" href="#" target="_blank" class="dl-card">Kualitas SD</a>
            <a id="hdLink" href="#" target="_blank" class="dl-card hd">Kualitas HD</a>
        </div>
    </div>
</div>

<script>
    let currentMode = 'public';

    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        document.getElementById('publicMode').style.display = (mode === 'public') ? 'block' : 'none';
        document.getElementById('privateMode').style.display = (mode === 'private') ? 'block' : 'none';
        document.getElementById('result').style.display = 'none';
    }

    async function processVideo() {
        const btn = document.getElementById('btnAction');
        btn.innerText = 'Sedang Memproses...';
        
        let htmlContent = '';

        if (currentMode === 'public') {
            const url = document.getElementById('fbUrl').value;
            if(!url) return alert('Masukkan URL!');
            try {
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                const data = await response.json();
                htmlContent = data.contents;
            } catch (e) {
                alert('Gagal mengambil data public.');
            }
        } else {
            htmlContent = document.getElementById('fbSource').value;
            if(!htmlContent) return alert('Masukkan Source Code!');
        }

        extractAndShow(htmlContent);
        btn.innerText = 'Ekstrak Video';
    }

    function extractAndShow(html) {
        // Regex diperkuat untuk mencari pola video terbaru
        const hdMatch = html.match(/browser_native_hd_url":"(.*?)"/);
        const sdMatch = html.match(/browser_native_sd_url":"(.*?)"/);

        if (sdMatch || hdMatch) {
            const hdUrl = hdMatch ? decodeUnicode(hdMatch[1]) : null;
            const sdUrl = sdMatch ? decodeUnicode(sdMatch[1]) : null;

            document.getElementById('hdLink').href = hdUrl || sdUrl;
            document.getElementById('sdLink').href = sdUrl || hdUrl;
            
            // Sembunyikan tombol HD jika memang tidak ada
            document.getElementById('hdLink').style.display = hdUrl ? 'block' : 'none';
            
            document.getElementById('result').style.display = 'block';
        } else {
            alert('Video tidak ditemukan. Jika ini video private, pastikan Anda menyalin seluruh Source Code halaman video tersebut.');
        }
    }

    function decodeUnicode(str) {
        try {
            return JSON.parse('"' + str + '"');
        } catch (e) {
            return str.replace(/\\u([\d\w]{4})/gi, (m, g) => String.fromCharCode(parseInt(g, 16))).replace(/\\/g, '');
        }
    }

    function openSourceHP() {
    const url = document.getElementById('fbUrl').value;
    if(!url) return alert('Masukkan link video dulu!');
    
    const sourceUrl = "view-source:" + url.replace("www.", "m.");
    
    // Alih-alih pop-up otomatis, kita buatkan link manual agar tidak diblokir browser
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = `
        <div style="background:#fff3cd; padding:15px; border-radius:15px; margin-top:10px; border:1px solid #ffeeba">
            <p style="font-size:13px; color:#856404; margin-bottom:10px">
                <b>Langkah selanjutnya:</b><br>
                1. Klik link di bawah ini.<br>
                2. Salin semua teks kode yang muncul.<br>
                3. Kembali ke sini dan tempel di kotak Private.
            </p>
            <a href="${sourceUrl}" target="_blank" style="color:#007bff; font-weight:bold; text-decoration:underline">
                KLIK DISINI UNTUK BUKA KODE SUMBER
            </a>
        </div>
    `;
    resultDiv.style.display = 'block';
    }
</script>

</body>
</html>
