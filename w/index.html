<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wayang Web3 Wallet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- VARIABLES & RESET --- */
        :root {
            --primary: #d35400; /* Warna Border Pilihan Anda */
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --text-main: #ffffff;
            --text-muted: #aaaaaa;
            --danger: #e74c3c;
            --success: #2ecc71;
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            /* Padding bawah agar tidak ketutup Nav (Solusi No. 1 & 3 tadi) */
            padding-bottom: calc(80px + var(--safe-area-bottom)); 
            min-height: 100vh;
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .container { padding: 20px; max-width: 480px; margin: 0 auto; }
        h1, h2, h3 { margin-bottom: 15px; font-weight: 600; }
        p { color: var(--text-muted); line-height: 1.5; margin-bottom: 15px; }

        /* --- COMPONENTS --- */
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: opacity 0.2s;
        }
        .btn:active { opacity: 0.8; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-text { background: transparent; color: var(--text-muted); font-size: 14px; }

        .input-group { margin-bottom: 20px; }
        input, textarea {
            width: 100%;
            padding: 15px;
            background: var(--bg-card);
            border: 1px solid #333;
            border-radius: 10px;
            color: white;
            font-size: 16px;
        }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); }

        /* --- CARDS (Dashboard) --- */
        .wallet-card {
            background: linear-gradient(135deg, #d35400 0%, #e67e22 100%);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
        }
        .balance-label { font-size: 14px; opacity: 0.9; }
        .balance-amount { font-size: 32px; font-weight: 800; margin: 10px 0; }
        .address-box {
            background: rgba(0,0,0,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .section-title { font-size: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        
        .asset-list { display: flex; flex-direction: column; gap: 10px; }
        .asset-item {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .asset-icon { width: 40px; height: 40px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--bg-card);
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            /* Safe Area Fix */
            padding-bottom: calc(15px + var(--safe-area-bottom));
            z-index: 1000;
        }
        .nav-item { color: var(--text-muted); text-align: center; font-size: 12px; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; margin-bottom: 5px; display: block; }

        /* --- TOAST --- */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 50px;
            padding: 16px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            bottom: 100px;
            transform: translateX(-50%);
            font-size: 14px;
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 100px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 100px; opacity: 1;} to {bottom: 0; opacity: 0;} }

    </style>
</head>
<body>

    <div id="screen-welcome" class="container">
        <div style="text-align: center; margin-top: 50px; margin-bottom: 50px;">
            <i class="fa-solid fa-wallet" style="font-size: 60px; color: var(--primary);"></i>
            <h1 style="margin-top: 20px;">Wayang Wallet</h1>
            <p>Gerbang aman menuju dunia Web3 dan NFT Wayang.</p>
        </div>
        <button class="btn" onclick="showScreen('screen-create')">Buat Dompet Baru</button>
        <button class="btn btn-outline" onclick="showScreen('screen-import')">Saya Sudah Punya Dompet</button>
    </div>

    <div id="screen-import" class="container hidden">
        <h2>Impor Dompet</h2>
        <p>Masukkan Private Key atau Recovery Phrase Anda.</p>
        <div class="input-group">
            <textarea id="import-input" rows="4" placeholder="Contoh: 0x123... atau apple banana cat..."></textarea>
        </div>
        <button class="btn" onclick="handleImport()">Masuk</button>
        <button class="btn btn-text" onclick="showScreen('screen-welcome')">Kembali</button>
    </div>

    <div id="screen-create" class="container hidden">
        <h2>Dompet Baru</h2>
        <p class="warning" style="color: var(--danger);">PENTING: Salin Private Key ini. Jika hilang, aset Anda lenyap selamanya.</p>
        <div class="input-group">
            <label style="font-size: 12px; color: var(--text-muted);">Private Key Anda:</label>
            <textarea id="new-pk-display" rows="3" readonly style="color: var(--primary); font-family: monospace;"></textarea>
        </div>
        <button class="btn btn-outline" onclick="copyToClipboard(document.getElementById('new-pk-display').value)">Salin Kunci</button>
        <button class="btn" onclick="finishSetup()">Saya Sudah Simpan</button>
    </div>

    <div id="screen-dashboard" class="hidden">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Dashboard</h3>
                <i class="fa-solid fa-bell" style="color: var(--text-muted);"></i>
            </div>

            <div class="wallet-card">
                <div class="balance-label">Total Saldo (ETH)</div>
                <div class="balance-amount" id="display-balance">0.0000</div>
                <div class="address-box" onclick="copyAddress()">
                    <span id="display-address">0x00...0000</span>
                    <i class="fa-regular fa-copy"></i>
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                <button class="btn" style="flex: 1; margin:0;"><i class="fa-solid fa-paper-plane"></i> Kirim</button>
                <button class="btn btn-outline" style="flex: 1; margin:0;"><i class="fa-solid fa-qrcode"></i> Terima</button>
            </div>

            <div class="section-title">
                <span>Aset & NFT</span>
                <span style="color: var(--primary); font-size: 14px;">Lihat Semua</span>
            </div>
            
            <div class="asset-list">
                <div class="asset-item">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="asset-icon"><i class="fa-brands fa-ethereum"></i></div>
                        <div>
                            <div style="font-weight: bold;">Ethereum</div>
                            <div style="font-size: 12px; color: var(--text-muted);">ETH</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold;" id="asset-eth-val">0</div>
                        <div style="font-size: 12px; color: var(--success);">+2.4%</div>
                    </div>
                </div>
                <div class="asset-item">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="asset-icon" style="color: gold;"><i class="fa-solid fa-mask"></i></div>
                        <div>
                            <div style="font-weight: bold;">Wayang Premium</div>
                            <div style="font-size: 12px; color: var(--text-muted);">NFT Badge</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold;">1</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Item</div>
                    </div>
                </div>
            </div>
        </div>

        <div style="height: 20px;"></div>
    </div>

    <nav id="main-nav" class="bottom-nav hidden">
        <div class="nav-item active">
            <i class="fa-solid fa-wallet"></i>
            Wallet
        </div>
        <div class="nav-item">
            <i class="fa-solid fa-compass"></i>
            Browser
        </div>
        <div class="nav-item">
            <i class="fa-solid fa-gear"></i>
            Setting
        </div>
    </nav>

    <div id="toast">Pesan Toast</div>

    <script type="module">
        import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";

        // --- STATE VARIABLES ---
        let currentWallet = null;
        // Provider Publik (Contoh pakai Sepolia Testnet agar gratis tesnya)
        const provider = new ethers.JsonRpcProvider("https://rpc.ankr.com/eth_sepolia");

        // --- DOM ELEMENTS ---
        const views = {
            welcome: document.getElementById('screen-welcome'),
            import: document.getElementById('screen-import'),
            create: document.getElementById('screen-create'),
            dashboard: document.getElementById('screen-dashboard'),
            nav: document.getElementById('main-nav')
        };

        // --- FUNGSI NAVIGASI ---
        window.showScreen = (screenName) => {
            // Sembunyikan semua
            Object.values(views).forEach(el => el.classList.add('hidden'));
            
            // Munculkan yang dipilih
            if(screenName === 'screen-welcome') views.welcome.classList.remove('hidden');
            if(screenName === 'screen-import') views.import.classList.remove('hidden');
            if(screenName === 'screen-create') {
                createNewWallet(); // Auto generate saat masuk layar ini
                views.create.classList.remove('hidden');
            }
            if(screenName === 'screen-dashboard') {
                views.dashboard.classList.remove('hidden');
                views.nav.classList.remove('hidden');
                updateDashboardUI();
            }
        }

        // --- LOGIKA WALLET ---

        // 1. Buat Wallet Baru
        async function createNewWallet() {
            const wallet = ethers.Wallet.createRandom();
            document.getElementById('new-pk-display').value = wallet.privateKey;
            currentWallet = wallet.connect(provider);
            // Simpan sementara di memori (Di Produksi: Simpan ke Android Keystore)
        }

        // 2. Import Wallet
        window.handleImport = async () => {
            const input = document.getElementById('import-input').value.trim();
            try {
                let wallet;
                if (input.includes(" ")) {
                    // Asumsi Mnemonic phrase
                    wallet = ethers.Wallet.fromPhrase(input);
                } else {
                    // Asumsi Private Key
                    wallet = new ethers.Wallet(input);
                }
                currentWallet = wallet.connect(provider);
                showToast("Import Berhasil!");
                window.showScreen('screen-dashboard');
            } catch (error) {
                showToast("Kunci tidak valid!");
                console.error(error);
            }
        }

        // 3. Selesai Setup Baru
        window.finishSetup = () => {
            if(currentWallet) {
                showToast("Dompet dibuat!");
                window.showScreen('screen-dashboard');
            }
        }

        // 4. Update UI Dashboard
        async function updateDashboardUI() {
            if(!currentWallet) return;

            // Format Address (0x1234...5678)
            const addr = currentWallet.address;
            const shortAddr = addr.substring(0, 6) + "..." + addr.substring(addr.length - 4);
            document.getElementById('display-address').innerText = shortAddr;

            // Ambil Saldo (Async)
            try {
                const balance = await provider.getBalance(addr);
                const ethVal = ethers.formatEther(balance);
                // Batasi desimal biar rapi (4 angka dibelakang koma)
                const formatted = parseFloat(ethVal).toFixed(4);
                
                document.getElementById('display-balance').innerText = formatted;
                document.getElementById('asset-eth-val').innerText = formatted;
            } catch (e) {
                console.log("Gagal ambil saldo (mungkin RPC limit/offline)");
            }
        }

        // --- UTILITIES ---
        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text);
            showToast("Disalin ke clipboard!");
        }

        window.copyAddress = () => {
            if(currentWallet) copyToClipboard(currentWallet.address);
        }

        window.showToast = (msg) => {
            const toast = document.getElementById("toast");
            toast.innerText = msg;
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }

        // Cek Local Storage (Simulasi Auto Login)
        // Di Android Native nanti, cek SharedPreference di sini
        // if (hasSavedWallet) showScreen('screen-dashboard');
    </script>
</body>
  </html>
